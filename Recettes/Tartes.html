<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atelier Tarte Citron - Mr. Minutieux</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --jaune-citron: #F4D03F;
            --croute-brune: #D35400;
            --acier: #2C3E50;
            --blanc: #ECF0F1;
            --meringue: #FDEDEC;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            background-color: var(--blanc);
            color: var(--acier);
            overflow-x: hidden;
        }

        /* --- UI PRINCIPALE --- */
        header {
            background: var(--acier);
            color: var(--jaune-citron);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        h1 { margin: 0; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 1px; }
        
        .badge {
            background: var(--jaune-citron);
            color: var(--acier);
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.8rem;
        }

        /* Section 3D */
        #canvas-container {
            width: 100%;
            height: 350px;
            background: radial-gradient(circle, #e0e0e0 0%, #bdc3c7 100%);
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid var(--jaune-citron);
        }

        .overlay-3d {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(255,255,255,0.8);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            pointer-events: none;
        }

        /* Grille de Recettes */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            background: var(--acier);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        button:hover {
            background: var(--jaune-citron);
            color: var(--acier);
        }

        button.secondary {
            background: transparent;
            border: 2px solid var(--acier);
            color: var(--acier);
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .card-header {
            height: 150px;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            position: relative;
        }

        .difficulty-meter {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 2px;
        }

        .dot { width: 10px; height: 10px; border-radius: 50%; background: #bdc3c7; }
        .dot.active { background: var(--croute-brune); }

        .card-body {
            padding: 15px;
            flex-grow: 1;
        }

        .card-footer {
            padding: 15px;
            border-top: 1px solid #eee;
            background: #f9f9f9;
        }

        /* Modal (D√©tails) */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 8px;
            padding: 25px;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--acier);
        }

        .tech-specs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
            background: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            border-left: 5px solid var(--acier);
        }

        .spec-list li { margin-bottom: 5px; }

        @media (max-width: 600px) {
            .tech-specs { grid-template-columns: 1fr; }
            h1 { font-size: 1.2rem; }
        }

    </style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center; gap:10px;">
        <span>üçã</span>
        <div>
            <h1>Atelier Tarte</h1>
            <small>Div. Mr. Minutieux</small>
        </div>
    </div>
    <span class="badge">v2.1.0 PRO</span>
</header>

<!-- Visualisation 3D -->
<div id="canvas-container">
    <div class="overlay-3d">Vue CAO: Mod√®le Meringu√© Standard</div>
</div>

<div class="container">
    <div class="controls">
        <button onclick="filterRecipes('all')">Tout Afficher</button>
        <button class="secondary" onclick="filterRecipes('easy')">D√©butant</button>
        <button class="secondary" onclick="filterRecipes('expert')">Ma√Ætre Charpentier</button>
        <button class="secondary" onclick="exportGlobalList()">‚¨á Exporter Inventaire (CSV)</button>
    </div>

    <div id="grid" class="recipe-grid">
        <!-- Les cartes sont g√©n√©r√©es ici par JS -->
    </div>
</div>

<!-- Modal D√©tails -->
<div id="modal" class="modal" onclick="if(event.target === this) closeModal()">
    <div class="modal-content">
        <button class="close-btn" onclick="closeModal()">&times;</button>
        <h2 id="modal-title" style="margin-top:0; color:var(--croute-brune);">Titre</h2>
        
        <div class="tech-specs">
            <div>
                <h3>üî© Mat√©riaux (Ingr√©dients)</h3>
                <ul id="modal-ingredients" class="spec-list"></ul>
            </div>
            <div>
                <h3>üõ† Outillage Requis</h3>
                <ul id="modal-tools" class="spec-list"></ul>
            </div>
        </div>

        <h3>üìã Proc√©dure d'assemblage</h3>
        <div id="modal-steps" style="line-height: 1.6;"></div>

        <div style="margin-top:20px; text-align:right;">
            <button onclick="alert('Impression envoy√©e √† l\'atelier!')">üñ® Imprimer le plan</button>
        </div>
    </div>
</div>

<script>
    // --- 1. BASE DE DONN√âES RECETTES (Pseudo-Backend) ---
    const db = [
        {
            id: 1,
            title: "La Classique de Chantier",
            level: 1, // 1=Easy, 3=Hard
            time: "1h 15m",
            icon: "ü•ß",
            desc: "Solide, fiable. La recette de base qui ne l√¢che pas.",
            ingredients: ["250g Farine T55", "125g Beurre froid", "4 Citrons (Jus + Zeste)", "150g Sucre", "4 Oeufs", "50g Ma√Øzena"],
            tools: ["Moule √ò24cm", "Fouet Inox", "Rouleau √† p√¢tisserie", "Billes de cuisson"],
            steps: [
                "1. Sabler la farine et le beurre. Ajouter un peu d'eau. Compacter.",
                "2. Foncer le moule. Cuire √† blanc 15 min √† 180¬∞C (renfort structurel).",
                "3. M√©langer oeufs, sucre, citron, ma√Øzena. Chauffer jusqu'√† √©paississement (viscosit√© √©lev√©e).",
                "4. Couler l'appareil sur le fond de tarte. Cuire 20 min."
            ]
        },
        {
            id: 2,
            title: "Le D√¥me Meringu√© Italien",
            level: 3,
            time: "2h 00m",
            icon: "üèî",
            desc: "Architecture complexe avec meringue italienne stabilis√©e au sirop √† 118¬∞C.",
            ingredients: ["Fond de tarte (voir recette 1)", "Appareil citron (voir recette 1)", "3 Blancs d'oeufs", "200g Sucre", "70g Eau"],
            tools: ["Thermom√®tre sonde", "Robot p√¢tissier", "Chalumeau", "Poche √† douille"],
            steps: [
                "1. Pr√©parer la tarte de base.",
                "2. Sirop: chauffer sucre + eau √† 118¬∞C pr√©cis (Point critique).",
                "3. Monter les blancs. Verser le sirop en filet (vitesse max).",
                "4. Pocher sur la tarte froide. Finition au chalumeau pour l'esth√©tique industrielle."
            ]
        },
        {
            id: 3,
            title: "Carr√©s Citron 'Lunchbox'",
            level: 1,
            time: "45m",
            icon: "üì¶",
            desc: "Format modulaire. Id√©al pour le transport et la consommation rapide.",
            ingredients: ["200g Beurre mou", "250g Farine", "400g Sucre", "4 Oeufs", "2 Citrons (Jus)"],
            tools: ["Moule carr√© 20x20", "Papier parchemin", "Fouet"],
            steps: [
                "1. Base sabl√©e : Beurre + 1/2 farine + 1/4 sucre. Presser au fond. Cuire 20 min.",
                "2. Appareil : Battre reste sucre, farine, oeufs, citron.",
                "3. Verser sur base chaude. Cuire 25 min.",
                "4. D√©coupe au laser (ou au couteau) apr√®s refroidissement total."
            ]
        }
    ];

    // --- 2. LOGIQUE D'APPLICATION ---
    const grid = document.getElementById('grid');

    function renderRecipes(filter = 'all') {
        grid.innerHTML = '';
        db.forEach(item => {
            if (filter === 'easy' && item.level > 1) return;
            if (filter === 'expert' && item.level < 3) return;

            const card = document.createElement('div');
            card.className = 'card';
            
            // Indicateur de difficult√©
            let dots = '';
            for(let i=0; i<3; i++) {
                dots += `<div class="dot ${i < item.level ? 'active' : ''}"></div>`;
            }

            card.innerHTML = `
                <div class="card-header">
                    ${item.icon}
                    <div class="difficulty-meter">${dots}</div>
                </div>
                <div class="card-body">
                    <h3 style="margin:0 0 10px 0;">${item.title}</h3>
                    <p style="font-size:0.9rem; color:#666;">${item.desc}</p>
                    <div style="display:flex; justify-content:space-between; margin-top:15px; font-weight:bold; font-size:0.8rem;">
                        <span>‚è± ${item.time}</span>
                        <span>üõ† ${item.tools.length} outils</span>
                    </div>
                </div>
                <div class="card-footer">
                    <button style="width:100%" onclick="openModal(${item.id})">Consulter le plan</button>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function openModal(id) {
        const recipe = db.find(r => r.id === id);
        document.getElementById('modal-title').innerText = recipe.title;
        
        // Populate lists
        const ingList = document.getElementById('modal-ingredients');
        ingList.innerHTML = recipe.ingredients.map(i => `<li>‚Ä¢ ${i}</li>`).join('');
        
        const toolList = document.getElementById('modal-tools');
        toolList.innerHTML = recipe.tools.map(t => `<li>üîß ${t}</li>`).join('');
        
        const stepsDiv = document.getElementById('modal-steps');
        stepsDiv.innerHTML = recipe.steps.map(s => `<p>${s}</p>`).join('');

        document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }

    function filterRecipes(type) {
        renderRecipes(type);
    }

    // Fonction d'export CSV (Base de donn√©es exportable)
    function exportGlobalList() {
        let csvContent = "data:text/csv;charset=utf-8,TYPE,ITEM,RECETTE\n";
        
        db.forEach(recipe => {
            recipe.ingredients.forEach(ing => {
                csvContent += `MATERIAU,"${ing}","${recipe.title}"\n`;
            });
            recipe.tools.forEach(tool => {
                csvContent += `OUTIL,"${tool}","${recipe.title}"\n`;
            });
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "inventaire_atelier_tarte.csv");
        document.body.appendChild(link);
        link.click();
    }

    // --- 3. VISUALISATION 3D (Three.js) ---
    function init3D() {
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        // Fond un peu bleut√©/industriel
        scene.background = new THREE.Color(0xe0e0e0);

        const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(0, 5, 8);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        // Lumi√®res
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(5, 10, 7);
        scene.add(dirLight);

        // Groupe Tarte
        const tartGroup = new THREE.Group();

        // 1. La Cro√ªte (Cylindre)
        const crustGeo = new THREE.CylinderGeometry(3, 2.8, 0.5, 32);
        const crustMat = new THREE.MeshStandardMaterial({ color: 0xD35400, roughness: 0.8 }); // Orange br√ªl√©
        const crust = new THREE.Mesh(crustGeo, crustMat);
        tartGroup.add(crust);

        // 2. La Cr√®me au Citron (Cylindre int√©rieur)
        const fillingGeo = new THREE.CylinderGeometry(2.8, 2.8, 0.55, 32);
        const fillingMat = new THREE.MeshStandardMaterial({ color: 0xF4D03F, roughness: 0.2, metalness: 0.1 }); // Jaune brillant
        const filling = new THREE.Mesh(fillingGeo, fillingMat);
        filling.position.y = 0.05;
        tartGroup.add(filling);

        // 3. Meringues (C√¥nes/Sph√®res)
        const meringueGeo = new THREE.ConeGeometry(0.3, 0.6, 16);
        const meringueMat = new THREE.MeshStandardMaterial({ color: 0xFFFFFF, roughness: 0.5 });
        
        // Boucle pour placer des pics de meringue en cercle
        for (let i = 0; i < 8; i++) {
            const angle = (i / 8) * Math.PI * 2;
            const x = Math.cos(angle) * 1.5;
            const z = Math.sin(angle) * 1.5;
            const peak = new THREE.Mesh(meringueGeo, meringueMat);
            peak.position.set(x, 0.4, z);
            tartGroup.add(peak);
        }
        // Un pic au centre
        const centerPeak = new THREE.Mesh(meringueGeo, meringueMat);
        centerPeak.position.set(0, 0.4, 0);
        tartGroup.add(centerPeak);

        scene.add(tartGroup);

        // Animation Loop
        function animate() {
            requestAnimationFrame(animate);
            tartGroup.rotation.y += 0.01; // Rotation lente
            tartGroup.rotation.x = Math.sin(Date.now() * 0.001) * 0.1; // L√©ger basculement
            renderer.render(scene, camera);
        }
        animate();

        // Resize handler
        window.addEventListener('resize', () => {
            const width = container.clientWidth;
            const height = container.clientHeight;
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
        });
    }

    // Initialisation
    window.onload = function() {
        renderRecipes();
        init3D();
    };

</script>

</body>
</html>
