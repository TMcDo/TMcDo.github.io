<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide Ac√©riculture DIY | Mr Minutieux</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #f8f5f0; 
            color: #2d3748; 
            /* Motif textur√© pour un look premium */
            background-image: radial-gradient(#d9770622 1px, transparent 1px); 
            background-size: 20px 20px; 
        }
        .tab-content { display: none; animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        #canvas-container { 
            width: 100%; 
            height: 400px; 
            background: radial-gradient(circle at top, #e0f2fe, #94a3b8); 
            border-radius: 0.75rem; 
            overflow: hidden; 
            cursor: grab; 
            box-shadow: inset 0 2px 15px rgba(0,0,0,0.1); 
            border: 2px solid #cbd5e1; 
        }
        #canvas-container:active { cursor: grabbing; }
        
        /* Barres de d√©filement custom */
        .custom-scrollbar::-webkit-scrollbar { height: 6px; width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #b45309; border-radius: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background-color: #fef3c7; border-radius: 6px; }
        
        /* Effet Glassmorphism pour les panneaux */
        .glass-panel { 
            background: rgba(255, 255, 255, 0.90); 
            backdrop-filter: blur(12px); 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); 
            border: 1px solid rgba(255, 255, 255, 0.8); 
        }
    </style>
</head>
<body class="antialiased custom-scrollbar">

    <!-- Header Pimp√© -->
    <header class="bg-gradient-to-r from-amber-900 via-amber-700 to-amber-800 text-white p-6 shadow-2xl border-b-4 border-amber-500 relative overflow-hidden">
        <div class="absolute inset-0 opacity-10 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4IiBoZWlnaHQ9IjgiPgo8cmVjdCB3aWR0aD0iOCIgaGVpZ2h0PSI4IiBmaWxsPSIjZmZmIj48L3JlY3Q+CjxwYXRoIGQ9Ik0wIDBMOCA4Wk04IDBMMCA4WiIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjEiPjwvcGF0aD4KPC9zdmc+')]"></div>
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center relative z-10">
            <h1 class="text-4xl font-extrabold tracking-tight drop-shadow-lg flex items-center gap-3">
                <span class="text-amber-300">üçÅ</span> Le Guide du Sucrier Minutieux
            </h1>
            <p class="text-amber-100 mt-3 md:mt-0 font-medium tracking-wide bg-black/20 px-4 py-1.5 rounded-full backdrop-blur-sm border border-amber-500/30 shadow-inner">
                Bricolage, √ârables & Sirop | DIY
            </p>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-4 mt-6 grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Left Column: Content Tabs -->
        <div class="lg:col-span-2 space-y-6">
            
            <!-- Navigation Tabs Modernis√©es -->
            <div class="flex space-x-2 p-2 bg-amber-100/80 rounded-2xl border border-amber-200 shadow-inner overflow-x-auto custom-scrollbar whitespace-nowrap backdrop-blur-sm">
                <button onclick="openTab('id-arbres')" class="tab-btn bg-amber-600 text-white shadow-md px-5 py-2.5 rounded-xl font-bold hover:bg-amber-700 transition transform hover:-translate-y-0.5">1. Identifier</button>
                <button onclick="openTab('fabrication')" class="tab-btn text-amber-900 px-5 py-2.5 rounded-xl font-bold hover:bg-amber-200 transition hover:-translate-y-0.5">2. Fabrication</button>
                <button onclick="openTab('suggestions')" class="tab-btn text-amber-900 px-5 py-2.5 rounded-xl font-bold hover:bg-amber-200 transition hover:-translate-y-0.5">3. Id√©es</button>
                <button onclick="openTab('assistant-ia')" class="tab-btn text-amber-900 px-5 py-2.5 rounded-xl font-bold hover:bg-amber-200 transition hover:-translate-y-0.5">4. Assistant ‚ú®</button>
                <button onclick="openTab('inventeur-diy')" class="tab-btn text-amber-900 px-5 py-2.5 rounded-xl font-bold hover:bg-amber-200 transition hover:-translate-y-0.5">5. Inventeur ‚ú®</button>
                <button onclick="openTab('analyseur-coulee')" class="tab-btn text-amber-900 px-5 py-2.5 rounded-xl font-bold hover:bg-amber-200 transition hover:-translate-y-0.5">6. Bilan ‚ú®</button>
                <button onclick="openTab('calibrateur')" class="tab-btn text-amber-900 px-5 py-2.5 rounded-xl font-bold hover:bg-amber-200 transition hover:-translate-y-0.5">7. Calibrateur</button>
                <button onclick="openTab('docteur-sirop')" class="tab-btn text-amber-900 px-5 py-2.5 rounded-xl font-bold hover:bg-amber-200 transition hover:-translate-y-0.5">8. Docteur ‚ú®</button>
                <button onclick="openTab('bois-chauffage')" class="tab-btn text-amber-900 px-5 py-2.5 rounded-xl font-bold hover:bg-amber-200 transition hover:-translate-y-0.5">9. Bois ü™µ</button>
            </div>

            <!-- Tab 1: Identification -->
            <div id="id-arbres" class="tab-content active glass-panel p-8 rounded-3xl">
                <h2 class="text-3xl font-extrabold text-amber-800 mb-6 border-b-2 border-amber-200 pb-3">üçÅ Identifier les √ârables (Hiver & √ât√©)</h2>
                
                <div class="space-y-6">
                    <!-- √ârable √† Sucre -->
                    <div class="bg-amber-50/80 p-5 rounded-2xl border-l-4 border-amber-600 shadow-sm transition hover:shadow-md">
                        <h3 class="font-bold text-xl text-amber-900 mb-3 flex items-center gap-2"><span>ü•á</span> √ârable √† sucre (Sugar Maple)</h3>
                        <div class="flex flex-col lg:flex-row gap-4 items-center">
                            <div class="w-full lg:w-1/2 text-gray-700 leading-relaxed">
                                <p><strong>Bourgeons :</strong> Bruns, pointus, en forme de c√¥ne. Oppos√©s sur la branche.<br>
                                <strong>√âcorce :</strong> Grise et lisse (jeune) ou fonc√©e avec de profondes crevasses verticales (vieux).<br>
                                <strong>Feuille :</strong> 5 lobes distincts, creux (sinus) ouverts en forme de "U".</p>
                                <p class="mt-3 text-sm bg-white p-2 rounded-lg inline-block shadow-sm border border-gray-100"><strong class="text-amber-700">Concentration en sucre :</strong> ~2.0% √† 3.0%+ (Ratio approx. 40:1). <em class="text-gray-500">Le roi du sirop!</em></p>
                            </div>
                            <div class="w-full lg:w-1/2 flex space-x-4 justify-center bg-white/60 p-4 rounded-xl shadow-inner border border-gray-100">
                                <!-- SVG Feuille √ârable √† Sucre -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto drop-shadow-md" aria-label="[Dessin Feuille √ârable √† Sucre]">
                                        <path d="M 50 95 L 50 75" stroke="#166534" stroke-width="2"/>
                                        <path d="M 50 75 C 60 75 70 80 75 80 L 70 65 L 85 60 L 75 50 L 90 40 C 80 40 70 45 60 45 C 65 35 65 25 70 15 L 58 20 L 50 5 L 42 20 L 30 15 C 35 25 35 35 40 45 C 30 45 20 40 10 40 L 25 50 L 15 60 L 30 65 L 25 80 C 30 80 40 75 50 75 Z" fill="#4ade80" stroke="#14532d" stroke-width="1.5" stroke-linejoin="round"/>
                                        <path d="M 50 75 L 50 15 M 50 65 L 15 40 M 50 65 L 85 40 M 40 45 L 30 15 M 60 45 L 70 15" stroke="#166534" stroke-width="1.5" fill="none" opacity="0.6"/>
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">Feuille</span>
                                </div>
                                <!-- SVG Bourgeon -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto drop-shadow-md" aria-label="[Dessin Bourgeon √ârable √† Sucre]">
                                        <rect x="47" y="40" width="6" height="60" fill="#5c4033" />
                                        <path d="M50 15 L58 40 L42 40 Z" fill="#4a3020" />
                                        <path d="M47 45 L38 35 L35 45 Z" fill="#4a3020" />
                                        <path d="M53 45 L62 35 L65 45 Z" fill="#4a3020" />
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">Bourgeon</span>
                                </div>
                                <!-- SVG √âcorce -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto rounded-lg border border-gray-300 drop-shadow-md" aria-label="[Dessin √âcorce √ârable √† Sucre]">
                                        <rect width="100" height="100" fill="#504a45" />
                                        <path d="M20 0 Q25 50 20 100 M40 0 Q35 50 40 100 M60 0 Q65 50 60 100 M80 0 Q75 50 80 100" stroke="#2a2520" stroke-width="5" fill="none" />
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">√âcorce</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- √ârable Noir (NOUVEAU) -->
                    <div class="bg-emerald-50/80 p-5 rounded-2xl border-l-4 border-emerald-700 shadow-sm transition hover:shadow-md">
                        <h3 class="font-bold text-xl text-emerald-900 mb-3 flex items-center gap-2"><span>ü•à</span> √ârable noir (Black Maple)</h3>
                        <div class="flex flex-col lg:flex-row gap-4 items-center">
                            <div class="w-full lg:w-1/2 text-gray-700 leading-relaxed">
                                <p><strong>Bourgeons :</strong> Tr√®s semblables √† l'√©rable √† sucre.<br>
                                <strong>√âcorce :</strong> Fonc√©e, presque noire, profond√©ment sillonn√©e.<br>
                                <strong>Feuille :</strong> 3 lobes principaux (rarement 5), bords affaiss√©s ou tombants, duvet sous la feuille.</p>
                                <p class="mt-3 text-sm bg-white p-2 rounded-lg inline-block shadow-sm border border-gray-100"><strong class="text-emerald-800">Concentration en sucre :</strong> ~2.0% √† 3.0%+ (Ratio 40:1). <em class="text-gray-500">Un autre excellent choix de coul√©e !</em></p>
                            </div>
                            <div class="w-full lg:w-1/2 flex space-x-4 justify-center bg-white/60 p-4 rounded-xl shadow-inner border border-gray-100">
                                <!-- SVG Feuille √ârable Noir -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto drop-shadow-md" aria-label="[Dessin Feuille √ârable Noir]">
                                        <path d="M 50 95 L 50 75" stroke="#14532d" stroke-width="2"/>
                                        <path d="M 50 80 C 65 85 80 80 85 70 C 80 65 75 60 70 60 C 80 55 90 45 90 35 C 75 40 65 45 60 45 C 65 35 70 20 65 15 L 50 5 L 35 15 C 30 20 35 35 40 45 C 35 45 25 40 10 35 C 10 45 20 55 30 60 C 25 60 20 65 15 70 C 20 80 35 85 50 80 Z" fill="#15803d" stroke="#064e3b" stroke-width="1.5" stroke-linejoin="round"/>
                                        <path d="M 50 80 L 50 10 M 50 70 L 20 35 M 50 70 L 80 35" stroke="#14532d" stroke-width="1.5" fill="none" opacity="0.6"/>
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">Feuille</span>
                                </div>
                                <!-- SVG Bourgeon Noir (M√™me que sucre) -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto drop-shadow-md" aria-label="[Dessin Bourgeon √ârable Noir]">
                                        <rect x="47" y="40" width="6" height="60" fill="#3b2b23" />
                                        <path d="M50 15 L58 40 L42 40 Z" fill="#2d1f18" />
                                        <path d="M47 45 L38 35 L35 45 Z" fill="#2d1f18" />
                                        <path d="M53 45 L62 35 L65 45 Z" fill="#2d1f18" />
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">Bourgeon</span>
                                </div>
                                <!-- SVG √âcorce Noire -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto rounded-lg border border-gray-300 drop-shadow-md" aria-label="[Dessin √âcorce √ârable Noir]">
                                        <rect width="100" height="100" fill="#2d2824" />
                                        <path d="M30 0 Q25 50 35 100 M70 0 Q65 50 75 100" stroke="#1a1510" stroke-width="8" fill="none" />
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">√âcorce</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- √ârable Rouge -->
                    <div class="bg-red-50/80 p-5 rounded-2xl border-l-4 border-red-600 shadow-sm transition hover:shadow-md">
                        <h3 class="font-bold text-xl text-red-900 mb-3">√ârable rouge (Red Maple)</h3>
                        <div class="flex flex-col lg:flex-row gap-4 items-center">
                            <div class="w-full lg:w-1/2 text-gray-700 leading-relaxed">
                                <p><strong>Bourgeons :</strong> Rouges, ronds, souvent en petites grappes (agglom√©r√©s).<br>
                                <strong>√âcorce :</strong> Gris p√¢le et lisse (jeune), ou plaques √©cailleuses (vieux).<br>
                                <strong>Feuille :</strong> 3 √† 5 lobes, bords tr√®s dentel√©s, creux en forme de "V", tige souvent rouge.</p>
                                <p class="mt-3 text-sm bg-white p-2 rounded-lg inline-block shadow-sm border border-gray-100"><strong class="text-red-700">Concentration en sucre :</strong> ~1.5% √† 2.0% (Ratio approx. 50:1). <em class="text-gray-500">T'as besoin d'un peu plus de bois!</em></p>
                            </div>
                            <div class="w-full lg:w-1/2 flex space-x-4 justify-center bg-white/60 p-4 rounded-xl shadow-inner border border-gray-100">
                                <!-- SVG Feuille √ârable Rouge -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto drop-shadow-md" aria-label="[Dessin Feuille √ârable Rouge]">
                                        <path d="M 50 95 L 50 70" stroke="#dc2626" stroke-width="2.5"/> 
                                        <path d="M 50 70 L 60 75 L 65 80 L 75 65 L 85 60 L 75 50 L 80 40 L 70 45 L 65 30 L 70 25 L 60 15 L 50 5 L 40 15 L 30 25 L 35 30 L 30 45 L 20 40 L 25 50 L 15 60 L 25 65 L 35 80 L 40 75 Z" fill="#22c55e" stroke="#166534" stroke-width="1.5" stroke-linejoin="round"/>
                                        <path d="M 50 70 L 50 15 M 50 60 L 20 40 M 50 60 L 80 40" stroke="#ef4444" stroke-width="1.5" fill="none" opacity="0.6"/>
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">Feuille</span>
                                </div>
                                <!-- SVG Bourgeon -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto drop-shadow-md" aria-label="[Dessin Bourgeon √ârable Rouge]">
                                        <rect x="47" y="50" width="6" height="50" fill="#8b5a2b" />
                                        <circle cx="50" cy="40" r="10" fill="#8b0000" />
                                        <circle cx="42" cy="48" r="7" fill="#8b0000" />
                                        <circle cx="58" cy="48" r="7" fill="#8b0000" />
                                        <circle cx="47" cy="37" r="4" fill="#a52a2a" />
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">Bourgeon</span>
                                </div>
                                <!-- SVG √âcorce -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto rounded-lg border border-gray-300 drop-shadow-md" aria-label="[Dessin √âcorce √ârable Rouge]">
                                        <rect width="100" height="100" fill="#8c8c8c" />
                                        <path d="M10 20 Q20 15 30 25 Q20 35 10 20 Z" fill="#696969" />
                                        <path d="M50 40 Q65 35 70 50 Q55 60 50 40 Z" fill="#696969" />
                                        <path d="M20 70 Q35 60 40 80 Q25 90 20 70 Z" fill="#696969" />
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">√âcorce</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- √ârable Argent√© -->
                    <div class="bg-slate-50/80 p-5 rounded-2xl border-l-4 border-slate-500 shadow-sm transition hover:shadow-md">
                        <h3 class="font-bold text-xl text-slate-800 mb-3">√ârable argent√© (Silver Maple)</h3>
                        <div class="flex flex-col lg:flex-row gap-4 items-center">
                            <div class="w-full lg:w-1/2 text-gray-700 leading-relaxed">
                                <p><strong>Bourgeons :</strong> Rouges √† bruns, agglom√©r√©s. Pousse en zones plus humides.<br>
                                <strong>√âcorce :</strong> Grise, se d√©tache en longues bandes verticales √©troites qui pendent (effiloch√©e).<br>
                                <strong>Feuille :</strong> 5 lobes tr√®s profond√©ment d√©coup√©s, argent√©e en dessous.</p>
                                <p class="mt-3 text-sm bg-white p-2 rounded-lg inline-block shadow-sm border border-gray-100"><strong class="text-slate-700">Concentration en sucre :</strong> ~1.5% √† 2.0% (Ratio approx. 50:1). <em class="text-gray-500">Fait du tr√®s bon sirop clair si bouilli rapidement!</em></p>
                            </div>
                            <div class="w-full lg:w-1/2 flex space-x-4 justify-center bg-white/60 p-4 rounded-xl shadow-inner border border-gray-100">
                                <!-- SVG Feuille √ârable Argent√© -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto drop-shadow-md" aria-label="[Dessin Feuille √ârable Argent√©]">
                                        <path d="M 50 95 L 50 70" stroke="#475569" stroke-width="2"/>
                                        <path d="M 50 70 C 60 70 65 75 70 80 L 75 65 L 90 60 L 80 55 L 95 40 C 80 40 75 45 65 50 L 65 30 L 75 20 L 60 20 L 50 2 L 40 20 L 25 20 L 35 30 L 35 50 C 25 45 20 40 5 40 L 20 55 L 10 60 L 25 65 L 30 80 C 35 75 40 70 50 70 Z" fill="#86efac" stroke="#166534" stroke-width="1.5" stroke-linejoin="round"/>
                                        <path d="M 50 70 L 50 15 M 50 65 L 15 40 M 50 65 L 85 40 M 35 50 L 30 20 M 65 50 L 70 20" stroke="#166534" stroke-width="1.5" fill="none" opacity="0.4"/>
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">Feuille</span>
                                </div>
                                <!-- SVG Bourgeon -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto drop-shadow-md" aria-label="[Dessin Bourgeon √ârable Argent√©]">
                                        <rect x="47" y="50" width="6" height="50" fill="#5c4033" />
                                        <circle cx="50" cy="40" r="11" fill="#8a3324" />
                                        <circle cx="41" cy="46" r="8" fill="#8a3324" />
                                        <circle cx="59" cy="46" r="8" fill="#8a3324" />
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">Bourgeon</span>
                                </div>
                                <!-- SVG √âcorce -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto rounded-lg border border-gray-300 drop-shadow-md" aria-label="[Dessin √âcorce √ârable Argent√©]">
                                        <rect width="100" height="100" fill="#9ca3af" />
                                        <path d="M25 10 L25 90 M50 0 L50 80 M75 20 L75 100" stroke="#4b5563" stroke-width="4" fill="none" />
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">√âcorce</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- √ârable √† Gigu√®re -->
                    <div class="bg-stone-50/80 p-5 rounded-2xl border-l-4 border-stone-600 shadow-sm transition hover:shadow-md">
                        <h3 class="font-bold text-xl text-stone-800 mb-3">√ârable √† Gigu√®re (Manitoba Maple / Boxelder)</h3>
                        <div class="flex flex-col lg:flex-row gap-4 items-center">
                            <div class="w-full lg:w-1/2 text-gray-700 leading-relaxed">
                                <p><strong>Bourgeons :</strong> Duvet blanc/argent√©. Ressemble √† un fr√™ne.<br>
                                <strong>√âcorce :</strong> Gris-brun, cr√™tes profondes qui s'entrecroisent.<br>
                                <strong>Feuille :</strong> Compos√©e de 3 √† 5 folioles. Ressemble beaucoup plus √† de l'herbe √† puce qu'√† une vraie feuille d'√©rable !</p>
                                <p class="mt-3 text-sm bg-white p-2 rounded-lg inline-block shadow-sm border border-gray-100"><strong class="text-red-700">Concentration en sucre :</strong> ~1.0% √† 1.5% (Ratio approx. 60:1 ou plus). <em class="text-gray-500">√áa coule, mais pr√©pare-toi √† b√ªcher en maudit!</em></p>
                            </div>
                            <div class="w-full lg:w-1/2 flex space-x-4 justify-center bg-white/60 p-4 rounded-xl shadow-inner border border-gray-100">
                                <!-- SVG Feuille Giguere -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto drop-shadow-md" aria-label="[Dessin Feuille √ârable √† Gigu√®re]">
                                        <path d="M 50 95 L 50 45" stroke="#166534" stroke-width="2"/>
                                        <path d="M 50 45 L 25 55 M 50 45 L 75 55" stroke="#166534" stroke-width="2"/>
                                        <path d="M 50 45 C 40 40 35 30 40 20 L 30 15 L 45 10 L 50 2 L 55 10 L 70 15 L 60 20 C 65 30 60 40 50 45 Z" fill="#4ade80" stroke="#14532d" stroke-width="1.5" stroke-linejoin="round"/>
                                        <path d="M 25 55 C 15 50 10 60 5 65 L 15 75 L 25 70 L 35 80 L 40 65 C 35 55 30 55 25 55 Z" fill="#4ade80" stroke="#14532d" stroke-width="1.5" stroke-linejoin="round"/>
                                        <path d="M 75 55 C 85 50 90 60 95 65 L 85 75 L 75 70 L 65 80 L 60 65 C 65 55 70 55 75 55 Z" fill="#4ade80" stroke="#14532d" stroke-width="1.5" stroke-linejoin="round"/>
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">Feuille</span>
                                </div>
                                <!-- SVG Bourgeon -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto drop-shadow-md" aria-label="[Dessin Bourgeon √ârable √† Gigu√®re]">
                                        <rect x="46" y="40" width="8" height="60" fill="#5c4033" />
                                        <path d="M40 45 Q50 25 60 45 Z" fill="#d1d5db" />
                                        <circle cx="50" cy="35" r="10" fill="#f3f4f6" />
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">Bourgeon</span>
                                </div>
                                <!-- SVG √âcorce -->
                                <div class="text-center transition transform hover:scale-110">
                                    <svg viewBox="0 0 100 100" class="w-16 h-16 mx-auto rounded-lg border border-gray-300 drop-shadow-md" aria-label="[Dessin √âcorce √ârable √† Gigu√®re]">
                                        <rect width="100" height="100" fill="#78716c" />
                                        <path d="M30 0 L20 50 L30 100 M60 0 L50 50 L60 100" stroke="#44403c" stroke-width="6" fill="none" />
                                    </svg>
                                    <span class="text-xs text-gray-500 font-bold mt-1 block">√âcorce</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- English minimized -->
                <div class="mt-8 pt-5 border-t border-amber-200 text-sm text-gray-600 bg-amber-50/50 p-5 rounded-xl">
                    <p class="font-extrabold mb-2 text-amber-900 flex items-center gap-2"><span>üá¨üáß</span> Quick English Guide: Year-round ID & Sugar Specs</p>
                    <ul class="list-disc pl-5 space-y-1">
                        <li><strong>Sugar/Black Maple:</strong> Best for syrup! U-shaped leaf dips or 3 droopy lobes for Black.</li>
                        <li><strong>Red Maple:</strong> Sharp V-shaped dips, red stem. Takes more wood!</li>
                        <li><strong>Silver Maple:</strong> Deeply cut leaves. Good light syrup.</li>
                        <li><strong>Boxelder:</strong> Compound leaves (looks like poison ivy). Prepare for a long boil buddy!</li>
                    </ul>
                </div>
            </div>

            <!-- Tab 2: Fabrication -->
            <div id="fabrication" class="tab-content glass-panel p-8 rounded-3xl">
                <h2 class="text-3xl font-extrabold text-amber-800 mb-6 border-b-2 border-amber-200 pb-3">üî• Faire son Sirop (M√©thode DIY)</h2>
                
                <ol class="list-decimal pl-6 space-y-5 text-gray-700 text-lg leading-relaxed marker:text-amber-600 marker:font-bold">
                    <li class="pl-2">
                        <strong class="text-amber-900">L'Entaillage :</strong> Attends que √ßa g√®le la nuit pis que √ßa d√©g√®le le jour (autour de f√©vrier/mars). Prends une m√®che 5/16 (id√©al pour pas trop blesser l'arbre). Perce √† une hauteur confortable, <strong>entre 3 pis 4 pieds (90 √† 120 cm)</strong> √† partir du sol ou d'la cro√ªte de neige. Perce √† environ 2 pouces de profond, avec un l√©ger angle vers le haut pour que l'eau coule bien. <em class="bg-amber-100 px-1 rounded">Tr√®s important :</em> √âloigne-toi d'au moins 6 pouces de c√¥t√© et 12 pouces en haut/bas d'une vieille cicatrice d'entaille. Frappe ton chalumeau doucement avec un marteau.
                    </li>
                    <li class="pl-2">
                        <strong class="text-amber-900">La Collecte :</strong> Accroche une chaudi√®re (un seau de plastique alimentaire fait la job, pas cher) ou installe de la tubulure si t'as une pente. L'eau d'√©rable se garde au froid, pas plus de 2-3 jours sinon √ßa g√¢te.
                    </li>
                    <li class="pl-2">
                        <strong class="text-amber-900">L'√âbullition (Le DIY √âvaporateur) :</strong> √áa prend environ 40 litres d'eau pour 1 litre de sirop. Fais pas √ßa dans la maison, √ßa va d√©coller ta tapisserie! Monte-toi un po√™le avec des blocs de b√©ton (cinder blocks) pis mets des pannes d'acier inoxydable sur le dessus (des bacs de buffet d'h√¥tel, c'est parfait pis pas cher). Chauffe au bois en malade.
                    </li>
                    <li class="pl-2">
                        <strong class="text-amber-900">La Finition :</strong> Quand √ßa commence √† √©paissir, transf√®re sur un petit rond au propane pour contr√¥ler la chaleur. Le sirop est pr√™t √† <strong>104¬∞C (219.2¬∞F)</strong>, soit 4¬∞C au-dessus du point d'√©bullition de l'eau ce jour-l√†. Passe √ßa dans un filtre en orlon (filtre √† sirop) tant que c'est ben chaud pis embouteille!
                    </li>
                </ol>

                <!-- English minimized -->
                <div class="mt-8 pt-5 border-t border-amber-200 text-sm text-gray-600 bg-amber-50/50 p-5 rounded-xl">
                    <p class="font-extrabold mb-2 text-amber-900 flex items-center gap-2"><span>üá¨üáß</span> Quick English Guide: DIY Syrup</p>
                    <p>1. <strong>Tap:</strong> Drill 3-4 feet (90-120cm) from the ground/snow. Use 5/16 bit, drill 2" deep slightly upward when nights are freezing and days are warm. Stay away from old scars. <br>
                    2. <strong>Collect:</strong> Food-grade buckets. Boil within 3 days. <br>
                    3. <strong>Boil:</strong> 40:1 ratio. Build a cheap cinder-block arch outside with stainless steel catering pans. Boil hard with dry wood.<br>
                    4. <strong>Finish:</strong> Finish on a propane stove. Syrup is done at exactly 104¬∞C (219¬∞F). Filter hot and bottle.</p>
                </div>
            </div>

            <!-- Tab 3: Suggestions -->
            <div id="suggestions" class="tab-content glass-panel p-8 rounded-3xl">
                <h2 class="text-3xl font-extrabold text-amber-800 mb-6 border-b-2 border-amber-200 pb-3">üí° Am√©liorations & Id√©es (Mr. Minutieux)</h2>
                
                <div class="space-y-4 text-gray-700 text-lg leading-relaxed">
                    <p>Pour continuer d'am√©liorer nos *setups* (toujours plus fort, toujours moins cher), voici mes suggestions pour tes prochains projets :</p>
                    <ul class="list-disc pl-6 space-y-3 marker:text-amber-500">
                        <li><strong class="text-amber-900">Pr√©-chauffeur d'eau (Pre-heater) :</strong> Enrouler un tube de cuivre autour de la chemin√©e de ton √©vaporateur DIY pour pr√©-chauffer l'eau avant qu'elle tombe dans la panne. √áa sauve du bois en titi!</li>
                        <li><strong class="text-amber-900">Extracteur au vacuum DIY :</strong> Utiliser une vieille pompe √† vide de thermopompe modifi√©e sur ton syst√®me de tubulure pour augmenter le rendement de 30%.</li>
                        <li><strong class="text-amber-900">Contr√¥leur de temp√©rature Arduino :</strong> Fabriquer une sonde thermocouple qui d√©clenche une petite alarme quand ton sirop atteint exactement 103.5¬∞C pour t'avertir de ralentir le feu.</li>
                    </ul>
                </div>

                <div class="mt-8 pt-5 border-t border-amber-200 text-sm text-gray-600 bg-amber-50/50 p-5 rounded-xl">
                    <p class="font-extrabold mb-2 text-amber-900 flex items-center gap-2"><span>üá¨üáß</span> Ideas for improvements</p>
                    <p>I suggest building a copper tube pre-heater around the exhaust stack, creating a DIY vacuum pump system for the tubing, or coding a cheap Arduino temperature alarm for the finishing pan.</p>
                </div>
            </div>

            <!-- Tab 4: Assistant IA -->
            <div id="assistant-ia" class="tab-content glass-panel p-8 rounded-3xl">
                <h2 class="text-3xl font-extrabold text-amber-800 mb-6 border-b-2 border-amber-200 pb-3 flex items-center gap-3"><span>ü§ñ</span> Assistant Ac√©ricole & Bricolage</h2>
                <p class="mb-6 text-gray-700 text-lg">T'as un probl√®me avec ton sirop ? Ton feu tire pas ? Ou tu veux savoir comment transformer un vieux frigidaire en √©quipement d'√©rabli√®re ? Demande-le √† l'assistant IA de Mr. Minutieux !</p>
                
                <div class="space-y-4">
                    <textarea id="ai-prompt" rows="3" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-amber-500 focus:border-amber-500 text-lg shadow-inner bg-white/80" placeholder="Ex: Mon sirop est plein de sable, qu'est-ce que j'ai mal fait ? / How can I use a broken fridge for my syrup setup?"></textarea>
                    
                    <button onclick="askGemini()" id="ai-btn" class="w-full bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-700 hover:to-amber-600 text-white font-bold py-4 px-6 rounded-xl transition transform hover:scale-[1.02] shadow-lg flex justify-center items-center text-lg">
                        Demander des conseils ‚ú®
                    </button>

                    <div id="ai-response-container" class="hidden mt-6 p-6 bg-white/80 border-l-4 border-amber-500 rounded-xl shadow-md">
                        <h3 class="font-extrabold text-amber-900 mb-3 text-lg">R√©ponse de Mr. Minutieux :</h3>
                        <div id="ai-response" class="text-gray-800 whitespace-pre-wrap leading-relaxed"></div>
                    </div>
                </div>
            </div>

            <!-- Tab 5: Inventeur DIY (New Gemini Feature) -->
            <div id="inventeur-diy" class="tab-content glass-panel p-8 rounded-3xl">
                <h2 class="text-3xl font-extrabold text-green-800 mb-6 border-b-2 border-green-200 pb-3 flex items-center gap-3"><span>üõ†Ô∏è</span> Le G√©n√©rateur de Patentes</h2>
                <p class="mb-6 text-gray-700 text-lg">T'as un tas de cochonneries qui tra√Ænent dans le fond de ton garage ? Dis-moi ce que t'as, pis je vais t'inventer une machine pour ton √©rabli√®re avec √ßa !</p>
                
                <div class="space-y-5">
                    <div class="bg-gray-50/80 p-5 rounded-2xl border border-gray-200 shadow-inner">
                        <label class="block text-base font-bold text-gray-700 mb-3">Qu'est-ce qui tra√Æne dans ton garage ?</label>
                        <textarea id="inventory-prompt" rows="2" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-green-500 focus:border-green-500 text-lg bg-white" placeholder="Ex: Une vieille balayeuse, un tuyau de s√©cheuse, deux chaises de patio en plastique, et du duct tape."></textarea>
                    </div>
                    
                    <button onclick="inventDIY()" id="invent-btn" class="w-full bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white font-bold py-4 px-6 rounded-xl transition transform hover:scale-[1.02] shadow-lg flex justify-center items-center text-lg">
                        Cr√©er une invention ac√©ricole ‚ú®
                    </button>

                    <div id="invention-container" class="hidden mt-6 p-6 bg-green-50/90 border-2 border-dashed border-green-400 rounded-2xl shadow-md">
                        <div class="flex items-center space-x-3 mb-4 border-b border-green-200 pb-3">
                            <span class="text-4xl">üí°</span>
                            <h3 class="text-2xl font-extrabold text-green-900">Nouvelle Invention D√©bloqu√©e !</h3>
                        </div>
                        <div id="invention-response" class="text-gray-800 space-y-3 leading-relaxed"></div>
                    </div>
                </div>
            </div>

            <!-- Tab 6: Analyseur de Coul√©e (New Gemini Feature) -->
            <div id="analyseur-coulee" class="tab-content glass-panel p-8 rounded-3xl">
                <h2 class="text-3xl font-extrabold text-blue-800 mb-6 border-b-2 border-blue-200 pb-3 flex items-center gap-3"><span>üìä</span> L'Analyseur de Coul√©e (IA)</h2>
                <p class="mb-6 text-gray-700 text-lg">Rentre tes chiffres de la journ√©e dans mon petit registre intelligent. Je vais analyser ton rendement, calculer ton sirop potentiel pis te dire si t'as eu une bonne "run" !</p>
                
                <div class="space-y-5">
                    <div class="grid grid-cols-2 gap-5">
                        <div class="bg-gray-50/80 p-4 rounded-2xl border border-gray-200 shadow-inner">
                            <label class="block text-sm font-bold text-gray-700 mb-2">Nb. d'entailles</label>
                            <input type="number" id="stats-taps" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-blue-500 bg-white" placeholder="Ex: 40" min="1">
                        </div>
                        <div class="bg-gray-50/80 p-4 rounded-2xl border border-gray-200 shadow-inner">
                            <label class="block text-sm font-bold text-gray-700 mb-2">Eau d'√©rable (Litres)</label>
                            <input type="number" id="stats-sap" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-blue-500 bg-white" placeholder="Ex: 120" min="0">
                        </div>
                    </div>
                    <div class="bg-gray-50/80 p-4 rounded-2xl border border-gray-200 shadow-inner">
                        <label class="block text-sm font-bold text-gray-700 mb-2">M√©t√©o / D√©roulement de la journ√©e</label>
                        <textarea id="stats-notes" rows="2" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-blue-500 bg-white" placeholder="Ex: Grosse gel√©e cette nuit, gros soleil √† midi. J'ai renvers√© une chaudi√®re."></textarea>
                    </div>
                    
                    <button onclick="analyzeYield()" id="analyze-btn" class="w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-bold py-4 px-6 rounded-xl transition transform hover:scale-[1.02] shadow-lg flex justify-center items-center text-lg">
                        Faire mon bilan de la journ√©e ‚ú®
                    </button>

                    <div id="analyze-container" class="hidden mt-6 p-6 bg-blue-50/90 border-l-4 border-blue-500 rounded-2xl shadow-md">
                        <h3 class="font-extrabold text-blue-900 mb-4 border-b border-blue-200 pb-2 text-xl">Le Verdict de Mr. Minutieux :</h3>
                        <div id="analyze-response" class="text-gray-800 space-y-3 leading-relaxed"></div>
                    </div>
                </div>
            </div>

            <!-- Tab 7: Calibrateur de cuisson -->
            <div id="calibrateur" class="tab-content glass-panel p-8 rounded-3xl">
                <h2 class="text-3xl font-extrabold text-red-800 mb-6 border-b-2 border-red-200 pb-3 flex items-center gap-3"><span>üå°Ô∏è</span> Le Calibrateur de Cuisson</h2>
                <p class="mb-6 text-gray-700 text-lg">Le point d'√©bullition change √† tous les jours avec la pression atmosph√©rique ! Fais bouillir de l'eau claire, prends la temp√©rature, pis je te dis √† combien sortir ton sirop pour qu'il soit parfait (66 Brix).</p>
                
                <div class="space-y-6">
                    <div class="bg-gray-50/80 p-5 rounded-2xl border border-gray-200 shadow-inner">
                        <label class="block text-base font-bold text-gray-700 mb-3">Temp√©rature de l'eau bouillante AUJOURD'HUI :</label>
                        <div class="flex space-x-3">
                            <input type="number" id="water-boil-temp" step="0.1" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-red-500 text-lg bg-white" placeholder="Ex: 99.5">
                            <select id="temp-unit" class="p-4 border-2 border-gray-200 rounded-xl focus:ring-red-500 bg-white font-bold text-lg cursor-pointer">
                                <option value="C">¬∞C</option>
                                <option value="F">¬∞F</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="calculateSyrupTemp()" class="w-full bg-gradient-to-r from-red-600 to-red-500 hover:from-red-700 hover:to-red-600 text-white font-bold py-4 px-6 rounded-xl transition transform hover:scale-[1.02] shadow-lg text-lg">
                        Calculer mon point de coul√©e üéØ
                    </button>

                    <div id="calibrateur-result" class="hidden mt-6 p-6 bg-red-50/90 border-2 border-red-200 rounded-2xl text-center shadow-md">
                        <p class="text-base text-red-800 font-bold mb-2">Ton sirop sera pr√™t √† exactement :</p>
                        <p id="syrup-target-temp" class="text-5xl font-black text-red-600 my-4 drop-shadow-sm"></p>
                        <p class="text-sm text-gray-600 mt-3 font-medium">N'oublie pas de v√©rifier avec ton densim√®tre pour √™tre s√ªr √† 100% !</p>
                    </div>
                </div>

                <!-- English minimized -->
                <div class="mt-8 pt-5 border-t border-red-200 text-sm text-gray-600 bg-red-50/50 p-5 rounded-xl">
                    <p class="font-extrabold mb-2 text-red-900 flex items-center gap-2"><span>üá¨üáß</span> Quick English Guide: Calibration</p>
                    <p>Boil plain water and measure its temp today. Add 4¬∞C (or 7.2¬∞F) to find your exact syrup finishing temperature. Don't rely blindly on 104¬∞C/219¬∞F!</p>
                </div>
            </div>

            <!-- Tab 8: Docteur Sirop (New Gemini Feature) -->
            <div id="docteur-sirop" class="tab-content glass-panel p-8 rounded-3xl">
                <h2 class="text-3xl font-extrabold text-purple-800 mb-6 border-b-2 border-purple-200 pb-3 flex items-center gap-3"><span>ü©∫</span> Le Docteur Sirop</h2>
                <p class="mb-6 text-gray-700 text-lg">Ton sirop a une dr√¥le de couleur ? Y go√ªte le bois vert ou y'a du sable dans l'fond ? D√©cris-moi ton probl√®me pis j'te dis ce qui cloche pis comment le sauver !</p>
                
                <div class="space-y-5">
                    <div class="bg-gray-50/80 p-5 rounded-2xl border border-gray-200 shadow-inner">
                        <label class="block text-base font-bold text-gray-700 mb-3">Sympt√¥mes de ton sirop :</label>
                        <textarea id="symptoms-prompt" rows="3" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-purple-500 bg-white text-lg" placeholder="Ex: Mon sirop a plein de sable fin gris au fond de la bouteille pis il est un peu brouill√©."></textarea>
                    </div>
                    
                    <button onclick="diagnoseSyrup()" id="diagnose-btn" class="w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-700 hover:to-purple-600 text-white font-bold py-4 px-6 rounded-xl transition transform hover:scale-[1.02] shadow-lg flex justify-center items-center text-lg">
                        Diagnostiquer mon sirop ‚ú®
                    </button>

                    <div id="diagnose-container" class="hidden mt-6 p-6 bg-purple-50/90 border-l-4 border-purple-500 rounded-2xl shadow-md">
                        <h3 class="font-extrabold text-purple-900 mb-4 border-b border-purple-200 pb-2 text-xl">Diagnostic de Mr. Minutieux :</h3>
                        <div id="diagnose-response" class="text-gray-800 space-y-3 leading-relaxed"></div>
                    </div>
                </div>
            </div>

            <!-- Tab 9: Bois de Chauffage (New Proactive Feature) -->
            <div id="bois-chauffage" class="tab-content glass-panel p-8 rounded-3xl">
                <h2 class="text-3xl font-extrabold text-orange-900 mb-6 border-b-2 border-orange-200 pb-3 flex items-center gap-3"><span>ü™µ</span> Estimateur de Bois de Chauffage</h2>
                <p class="mb-6 text-gray-700 text-lg">Rien de pire que de manquer de bois sec en pleine saison des sucres ! Rentre tes entailles pis je vais te dire combien de cordes √ßa te prend pour ton √©vaporateur DIY.</p>
                
                <div class="space-y-6">
                    <div class="bg-gray-50/80 p-5 rounded-2xl border border-gray-200 shadow-inner">
                        <label class="block text-base font-bold text-gray-700 mb-3">Nombre d'entailles (Taps) :</label>
                        <input type="number" id="wood-taps-input" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-orange-500 bg-white text-lg" placeholder="Ex: 50" min="1">
                    </div>
                    
                    <button onclick="calculateWood()" class="w-full bg-gradient-to-r from-orange-800 to-orange-700 hover:from-orange-900 hover:to-orange-800 text-white font-bold py-4 px-6 rounded-xl transition transform hover:scale-[1.02] shadow-lg text-lg">
                        Calculer mon bois ü™ì
                    </button>

                    <div id="wood-result" class="hidden mt-6 p-6 bg-orange-50/90 border-2 border-orange-200 rounded-2xl text-center shadow-md">
                        <p class="text-base text-orange-800 font-bold mb-2">Il va te falloir environ :</p>
                        <p id="wood-target" class="text-5xl font-black text-orange-900 my-4 drop-shadow-sm"></p>
                        <p class="text-sm text-gray-600 mt-3">Bas√© sur une moyenne d'une corde aux 100 entailles (pour un p'tit √©vaporateur pas hyper performant). Pr√©pare ta hache !</p>
                    </div>
                </div>

                <!-- English minimized -->
                <div class="mt-8 pt-5 border-t border-orange-200 text-sm text-gray-600 bg-orange-50/50 p-5 rounded-xl">
                    <p class="font-extrabold mb-2 text-orange-900 flex items-center gap-2"><span>üá¨üáß</span> Quick English Guide: Firewood</p>
                    <p>Enter your tap count. A basic DIY setup burns roughly 1 full cord of dry hardwood per 100 taps for the season. Chop chop!</p>
                </div>
            </div>

        </div>

        <!-- Right Column: 3D Canvas & Database -->
        <div class="space-y-6">
            
            <!-- 3D Viewer -->
            <div class="glass-panel p-5 rounded-3xl">
                <div class="flex items-center gap-3 mb-4 border-b border-gray-200 pb-3">
                    <span class="text-3xl drop-shadow-md">üå≤</span>
                    <div>
                        <h3 class="font-extrabold text-xl text-gray-800">Maquette 3D Interactive</h3>
                        <p class="text-sm text-amber-600 font-bold">Maintenant avec neige et boucane !</p>
                    </div>
                </div>
                <div id="canvas-container" class="border-4 border-white/50"></div>
            </div>

            <!-- Materials Database -->
            <div class="glass-panel p-5 rounded-3xl">
                <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-4">
                    <h3 class="font-extrabold text-xl text-gray-800 flex items-center gap-2">
                        <span>üìã</span> Mat√©riel DIY
                    </h3>
                    <button onclick="exportCSV()" class="bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white text-sm px-4 py-2 rounded-xl shadow-md transition transform hover:scale-105 font-bold">
                        üì• Exporter CSV
                    </button>
                </div>
                <p class="text-xs text-gray-500 font-medium mb-3">Sers-toi de cette liste comme checklist √† la quincaillerie !</p>
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="min-w-full text-sm text-left" id="materialsTable">
                        <thead class="bg-gray-100/80 text-gray-700 border-b-2 border-gray-200">
                            <tr>
                                <th class="px-3 py-3 rounded-tl-lg">‚úì</th>
                                <th class="px-3 py-3">Cat√©gorie</th>
                                <th class="px-3 py-3">Item (FR)</th>
                                <th class="px-3 py-3">Item (EN)</th>
                                <th class="px-3 py-3 text-center rounded-tr-lg">Qt√©</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>

    <footer class="text-center text-gray-600 font-medium text-sm py-10 mt-10 border-t border-amber-300/50 bg-white/30 backdrop-blur-sm">
        &copy; 2026 Mr Minutieux (www.mrminutieux.ca). Con√ßu robuste, pas cher, pis pas mal beau !
    </footer>

    <!-- Logic Script -->
    <script>
        // --- UI Logic ---
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-amber-600', 'text-white', 'shadow-md');
                btn.classList.add('text-amber-900');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.remove('text-amber-900');
            event.currentTarget.classList.add('bg-amber-600', 'text-white', 'shadow-md');
        }

        // --- Database Logic avec Checkboxes ---
        const materialsDB = [
            { category: "M√©tal", fr: "Pannes Inox (Gastronorme)", en: "Stainless Hotel Pans", qty: 3 },
            { category: "Structure", fr: "Blocs de b√©ton (Cinder blocks)", en: "Cinder blocks", qty: 45 },
            { category: "Structure", fr: "2x4x8 Bois trait√©", en: "2x4x8 Treated Wood", qty: 12 },
            { category: "Structure", fr: "T√¥le ondul√©e (Toit)", en: "Corrugated Tin Roof", qty: 4 },
            { category: "Quincaillerie", fr: "Vis √† bois 3 pouces", en: "3-inch Wood Screws", qty: 100 },
            { category: "Outil", fr: "M√®che 5/16 pour bois", en: "5/16 Wood Drill Bit", qty: 1 },
            { category: "Outil", fr: "Ruban √† mesurer", en: "Measuring Tape", qty: 1 },
            { category: "Outil", fr: "Thermom√®tre √† bonbon", en: "Candy Thermometer", qty: 1 },
            { category: "Outil", fr: "Densim√®tre (Hydrom√®tre)", en: "Hydrometer", qty: 1 },
            { category: "Outil", fr: "R√©fractom√®tre Brix", en: "Brix Refractometer", qty: 1 },
            { category: "Plomberie", fr: "Tuyau de cuivre flexible 3/8 (50 pi)", en: "3/8 Copper Tubing Coil", qty: 1 },
            { category: "Plomberie", fr: "Valve de contr√¥le en laiton", en: "Brass Needle Valve", qty: 1 },
            { category: "Plastique", fr: "Chalumeaux 5/16", en: "5/16 Spiles", qty: 50 },
            { category: "Plastique", fr: "Chaudi√®res 2 Gallons", en: "2 Gal Buckets", qty: 50 },
            { category: "Divers", fr: "Filtre Orlon √©pais", en: "Heavy Orlon Filter", qty: 1 },
            { category: "M√©tal", fr: "Grille en fonte (pour le feu)", en: "Cast iron grate", qty: 1 },
            { category: "Combustible", fr: "Corde de bois franc", en: "Hardwood cord", qty: 3 }
        ];

        function loadTable() {
            const tbody = document.querySelector('#materialsTable tbody');
            materialsDB.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-amber-50/50 transition duration-150";
                tr.innerHTML = `
                    <td class="px-3 py-3"><input type="checkbox" class="w-5 h-5 text-amber-600 rounded border-gray-300 focus:ring-amber-500 cursor-pointer shadow-sm" id="check-${index}"></td>
                    <td class="px-3 py-3 font-semibold text-gray-600"><span class="bg-gray-200/80 border border-gray-300 px-2 py-1 rounded-md text-xs">${item.category}</span></td>
                    <td class="px-3 py-3 font-bold text-gray-800 cursor-pointer" onclick="document.getElementById('check-${index}').click()">${item.fr}</td>
                    <td class="px-3 py-3 text-gray-500 italic text-xs">${item.en}</td>
                    <td class="px-3 py-3 text-center font-black text-amber-800 bg-amber-100/50 rounded-lg">${item.qty}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        loadTable();

        function exportCSV() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Categorie,Item_FR,Item_EN,Quantite\n";
            materialsDB.forEach(row => {
                csvContent += `${row.category},"${row.fr}","${row.en}",${row.qty}\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "Materiaux_Acericulture_Minutieux.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- Custom App Logic ---
        function calculateSyrupTemp() {
            const temp = parseFloat(document.getElementById('water-boil-temp').value);
            const unit = document.getElementById('temp-unit').value;
            const resultBox = document.getElementById('calibrateur-result');
            const targetDisplay = document.getElementById('syrup-target-temp');

            if (isNaN(temp)) {
                targetDisplay.innerHTML = "<span class='text-xl'>Mets un chiffre valide mon chum !</span>";
                resultBox.classList.remove('hidden');
                return;
            }

            let targetTemp;
            if (unit === 'C') {
                targetTemp = (temp + 4.0).toFixed(1) + " ¬∞C";
            } else {
                targetTemp = (temp + 7.2).toFixed(1) + " ¬∞F";
            }

            targetDisplay.innerText = targetTemp;
            resultBox.classList.remove('hidden');
        }

        function calculateWood() {
            const taps = parseInt(document.getElementById('wood-taps-input').value);
            const resultBox = document.getElementById('wood-result');
            const targetDisplay = document.getElementById('wood-target');

            if (isNaN(taps) || taps < 1) {
                targetDisplay.innerHTML = "<span class='text-xl'>Rentres au moins 1 entaille !</span>";
                resultBox.classList.remove('hidden');
                return;
            }

            const cords = (taps / 100).toFixed(1);
            let displayString = cords + " corde(s)";
            
            if (cords > 10) {
                displayString += " <br><span class='text-base font-normal text-orange-700 mt-2 block'>Ouin, ach√®te-toi une fendeuse !</span>";
            } else if (cords < 0.5) {
                displayString += " <br><span class='text-base font-normal text-orange-700 mt-2 block'>Tu vas passer √ßa en un weekend d'allumage !</span>";
            }

            targetDisplay.innerHTML = displayString;
            resultBox.classList.remove('hidden');
        }

        // --- Gemini API Logic ---
        const apiKey = ""; // La cl√© sera inject√©e automatiquement par l'environnement
        
        async function fetchWithRetry(url, options, maxRetries = 5) {
            let retries = 0;
            const delays = [1000, 2000, 4000, 8000, 16000];
            while (retries < maxRetries) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return response;
                    if (response.status !== 429 && response.status < 500) {
                        return response;
                    }
                } catch (error) { }
                if (retries < maxRetries - 1) {
                    await new Promise(resolve => setTimeout(resolve, delays[retries]));
                }
                retries++;
            }
            throw new Error("Toutes les tentatives de connexion ont √©chou√©.");
        }

        async function askGemini() {
            const promptInput = document.getElementById('ai-prompt').value.trim();
            const responseContainer = document.getElementById('ai-response-container');
            const responseDiv = document.getElementById('ai-response');
            const btn = document.getElementById('ai-btn');

            if (!promptInput) return;

            btn.disabled = true;
            btn.innerHTML = 'R√©flexion en cours... <svg class="animate-spin ml-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
            responseContainer.classList.remove('hidden');
            responseDiv.innerHTML = '<span class="text-gray-500 italic font-medium">Mr. Minutieux fouille dans son coffre √† outils...</span>';

            const systemInstruction = "Tu es Mr. Minutieux, un expert qu√©b√©cois en ac√©riculture (sirop d'√©rable) DIY (fait maison). Tu r√©ponds aux questions des utilisateurs avec un ton amical, rustique et ing√©nieux. Tu utilises des expressions qu√©b√©coises. Tes solutions sont toujours ax√©es sur le syst√®me D, le faible co√ªt, et la r√©utilisation de mat√©riel. Si l'utilisateur pose une question en anglais, r√©ponds en anglais avec un accent canadien-fran√ßais (ex: 'Listen buddy'). Garde les r√©ponses concises et tr√®s pratiques.";
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: promptInput }] }], systemInstruction: { parts: [{ text: systemInstruction }] } };

            try {
                const response = await fetchWithRetry(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error("Erreur de communication.");
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong class="text-amber-900">$1</strong>');
                    responseDiv.innerHTML = formattedText;
                } else {
                    responseDiv.innerHTML = "Oups, j'ai √©chapp√© ma chaudi√®re. Essaie de reformuler ta question !";
                }
            } catch (error) {
                responseDiv.innerHTML = `<span class="text-red-600 font-bold">Erreur:</span> L'√©vaporateur fait trop de boucane ! (${error.message})`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Demander des conseils ‚ú®';
            }
        }

        async function inventDIY() {
            const inventoryInput = document.getElementById('inventory-prompt').value.trim();
            const responseContainer = document.getElementById('invention-container');
            const responseDiv = document.getElementById('invention-response');
            const btn = document.getElementById('invent-btn');

            if (!inventoryInput) return;

            btn.disabled = true;
            btn.innerHTML = 'Conception en cours... <svg class="animate-spin ml-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
            responseContainer.classList.remove('hidden');
            responseDiv.innerHTML = '<span class="text-gray-500 italic font-medium">Mr. Minutieux dessine des plans sur une napkin...</span>';

            const systemInstruction = "Tu es Mr. Minutieux, un patenteux et inventeur qu√©b√©cois excentrique sp√©cialis√© dans le sirop d'√©rable. L'utilisateur te fournit une liste d'objets inutiles trouv√©s dans son garage. Tu dois inventer une machine ou un outil pour l'ac√©riculture en utilisant UNIQUEMENT ces objets (et un peu de duct tape ou de tie-wraps). Ta r√©ponse DOIT inclure: 1. Le nom loufoque de la patente. 2. √Ä quoi √ßa sert (ex: brasser le sirop, pomper l'eau). 3. Les √©tapes d'assemblage (tr√®s dr√¥les et format√©es en syst√®me D). 4. Une 'Cote de s√©curit√© Mr. Minutieux' sur 10. Formate la r√©ponse directement en HTML valide (utilise <strong>, <ul>, <li>, <p>, <h3>) sans markdown ni balises de code autour. Style les <strong> en couleur verte.";
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: `Voici ce que j'ai dans mon garage : ${inventoryInput}` }] }], systemInstruction: { parts: [{ text: systemInstruction }] } };

            try {
                const response = await fetchWithRetry(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error("Erreur API.");
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    let cleanHTML = text.replace(/```html/g, '').replace(/```/g, '');
                    responseDiv.innerHTML = cleanHTML;
                } else {
                    responseDiv.innerHTML = "<p>Oups, mon plan a pris en feu. Essaie d'autres objets !</p>";
                }
            } catch (error) {
                responseDiv.innerHTML = `<p class="text-red-600 font-bold">Erreur de conception : L'inspecteur des assurances a bloqu√© l'id√©e. (${error.message})</p>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Cr√©er une invention ac√©ricole ‚ú®';
            }
        }

        async function analyzeYield() {
            const taps = document.getElementById('stats-taps').value;
            const sap = document.getElementById('stats-sap').value;
            const notes = document.getElementById('stats-notes').value.trim();
            const responseContainer = document.getElementById('analyze-container');
            const responseDiv = document.getElementById('analyze-response');
            const btn = document.getElementById('analyze-btn');

            if (!taps || !sap) {
                responseContainer.classList.remove('hidden');
                responseDiv.innerHTML = "<p class='text-red-600 font-bold'>Wo minute papillon ! Remplis au moins tes entailles et ton eau ramass√©e !</p>";
                return;
            }

            btn.disabled = true;
            btn.innerHTML = 'Calcul mental en cours... <svg class="animate-spin ml-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
            responseContainer.classList.remove('hidden');
            responseDiv.innerHTML = '<span class="text-gray-500 italic font-medium">Mr. Minutieux pitonne sur sa calculatrice...</span>';

            const systemInstruction = "Tu es Mr. Minutieux, un ac√©riculteur qu√©b√©cois d'exp√©rience. L'utilisateur te donne son bilan journalier: nombre d'entailles, litres d'eau d'√©rable r√©colt√©s, et ses notes/m√©t√©o. Fais 3 choses : 1) Calcule combien de sirop √ßa va donner (r√®gle du 40 pour 1). 2) √âvalue son rendement (ex: un bon arbre donne de 1 √† 2 litres d'eau par jour de bonne coul√©e). 3) Donne un conseil ou une pr√©diction amusante bas√©e sur sa m√©t√©o ou ses commentaires. Ton ton est amical, encourageant, avec des expressions du Qu√©bec. R√©ponds en HTML valide (utilise <strong>, <ul>, <li>, <p>) sans bloc de code markdown autour. Mets les √©l√©ments importants en gras et bleu.";
            const userInput = `Entailles: ${taps}\nEau r√©colt√©e: ${sap} Litres\nM√©t√©o/Notes: ${notes || "Pas de notes sp√©cifiques"}`;
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: userInput }] }], systemInstruction: { parts: [{ text: systemInstruction }] } };

            try {
                const response = await fetchWithRetry(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error("Erreur API.");
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    let cleanHTML = text.replace(/```html/g, '').replace(/```/g, '');
                    responseDiv.innerHTML = cleanHTML;
                } else {
                    responseDiv.innerHTML = "<p>Oups, ma calculatrice a manqu√© de batteries. Essaie encore !</p>";
                }
            } catch (error) {
                responseDiv.innerHTML = `<p class="text-red-600 font-bold">Erreur : Impossible de faire les calculs. L'√©vaporateur tire trop de jus. (${error.message})</p>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Faire mon bilan de la journ√©e ‚ú®';
            }
        }

        async function diagnoseSyrup() {
            const symptoms = document.getElementById('symptoms-prompt').value.trim();
            const responseContainer = document.getElementById('diagnose-container');
            const responseDiv = document.getElementById('diagnose-response');
            const btn = document.getElementById('diagnose-btn');

            if (!symptoms) {
                responseContainer.classList.remove('hidden');
                responseDiv.innerHTML = "<p class='text-red-600 font-bold'>D√©cris-moi ton sirop d'abord, j'suis pas devin !</p>";
                return;
            }

            btn.disabled = true;
            btn.innerHTML = 'Analyse en cours... <svg class="animate-spin ml-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
            responseContainer.classList.remove('hidden');
            responseDiv.innerHTML = '<span class="text-gray-500 italic font-medium">Mr. Minutieux go√ªte ton sirop avec une petite cuill√®re en bois...</span>';

            const systemInstruction = "Tu es Mr. Minutieux, un expert ac√©riculteur. L'utilisateur te d√©crit un probl√®me avec son sirop d'√©rable (go√ªt, texture, couleur, odeur). Tu dois : 1) Identifier le d√©faut le plus probable (ex: sable de sucre/nitre, sirop de bourgeon, surcuisson, fermentation, eau de lavage). 2) Expliquer pourquoi c'est arriv√© en termes simples. 3) Donner une solution DIY pour le sauver (si possible) ou pour le pr√©venir l'an prochain. Ton ton est amical et de bon conseil, avec des expressions qu√©b√©coises. R√©ponds en HTML valide (utilise <strong>, <ul>, <li>, <p>) sans bloc de code markdown autour. Mets les diagnostics en violet.";
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: `Voici les sympt√¥mes de mon sirop : ${symptoms}` }] }], systemInstruction: { parts: [{ text: systemInstruction }] } };

            try {
                const response = await fetchWithRetry(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error("Erreur API.");
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    let cleanHTML = text.replace(/```html/g, '').replace(/```/g, '');
                    responseDiv.innerHTML = cleanHTML;
                } else {
                    responseDiv.innerHTML = "<p>Oups, √ßa go√ªte tellement bizarre que j'en perds mes mots. Essaie d'√™tre plus pr√©cis !</p>";
                }
            } catch (error) {
                responseDiv.innerHTML = `<p class="text-red-600 font-bold">Erreur : Impossible de faire le diagnostic. (${error.message})</p>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Diagnostiquer mon sirop ‚ú®';
            }
        }

        // --- Three.js 3D Visualization (Pimped up with Snow and Smoke) ---
        function init3D() {
            const container = document.getElementById('canvas-container');
            const scene = new THREE.Scene();
            // Fond d√©grad√© plus naturel g√©r√© par CSS, on laisse le fond Three.js transparent si possible, mais on garde le bleu hivernal
            scene.background = null; 

            const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(18, 12, 22);

            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true }); // Alpha true pour voir le fond CSS
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap; // Ombres plus douces
            container.appendChild(renderer.domElement);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.target.set(0, 3, 0);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xfffaeb, 0.9);
            dirLight.position.set(15, 25, 15);
            dirLight.castShadow = true;
            dirLight.shadow.mapSize.width = 1024;
            dirLight.shadow.mapSize.height = 1024;
            scene.add(dirLight);

            // Ground (Snow)
            const groundGeo = new THREE.PlaneGeometry(60, 60);
            const groundMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.9, metalness: 0.1 });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // Tree Trunk
            const trunkGeo = new THREE.CylinderGeometry(1.5, 2, 18, 16);
            const trunkMat = new THREE.MeshStandardMaterial({ color: 0x4a3728, roughness: 1.0 }); // Plus fonc√©
            const trunk = new THREE.Mesh(trunkGeo, trunkMat);
            trunk.position.set(-6, 9, -2);
            trunk.castShadow = true;
            trunk.receiveShadow = true;
            scene.add(trunk);

            // Tap & Bucket
            const tapGeo = new THREE.CylinderGeometry(0.1, 0.1, 0.8, 8);
            const tapMat = new THREE.MeshStandardMaterial({ color: 0xcccccc, metalness: 0.9, roughness: 0.2 });
            const tap = new THREE.Mesh(tapGeo, tapMat);
            tap.rotation.z = Math.PI / 2;
            tap.position.set(-4.2, 4, -2);
            scene.add(tap);

            const bucketGeo = new THREE.CylinderGeometry(0.6, 0.5, 1.2, 16);
            bucketMat = new THREE.MeshStandardMaterial({ color: 0xe5e7eb, metalness: 0.2, roughness: 0.5 });
            const bucket = new THREE.Mesh(bucketGeo, bucketMat);
            bucket.position.set(-3.6, 3, -2);
            bucket.castShadow = true;
            scene.add(bucket);

            // DIY Evaporator (Cinder blocks - En forme de U pour voir le feu!)
            const blockMat = new THREE.MeshStandardMaterial({ color: 0x94a3b8, roughness: 0.9 }); 
            
            // Mur de gauche
            const leftWallGeo = new THREE.BoxGeometry(0.6, 3, 6.2);
            const leftWall = new THREE.Mesh(leftWallGeo, blockMat);
            leftWall.position.set(2.2, 1.5, 2);
            leftWall.castShadow = true; leftWall.receiveShadow = true;
            scene.add(leftWall);

            // Mur de droite
            const rightWallGeo = new THREE.BoxGeometry(0.6, 3, 6.2);
            const rightWall = new THREE.Mesh(rightWallGeo, blockMat);
            rightWall.position.set(5.8, 1.5, 2);
            rightWall.castShadow = true; rightWall.receiveShadow = true;
            scene.add(rightWall);

            // Mur du fond
            const backWallGeo = new THREE.BoxGeometry(3.0, 3, 0.6);
            const backWall = new THREE.Mesh(backWallGeo, blockMat);
            backWall.position.set(4, 1.5, -0.8);
            backWall.castShadow = true; backWall.receiveShadow = true;
            scene.add(backWall);

            // B√ªches en feu dans la bo√Æte √† feu
            const burningLogGeo = new THREE.CylinderGeometry(0.2, 0.2, 2, 8);
            const burningLogMat = new THREE.MeshStandardMaterial({ 
                color: 0x111111, 
                emissive: 0xff4500, // Rougeoyant
                emissiveIntensity: 0.8,
                roughness: 0.9 
            });
            for(let i=0; i<4; i++) {
                const fireLog = new THREE.Mesh(burningLogGeo, burningLogMat);
                fireLog.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
                fireLog.position.set(3.5 + Math.random(), 0.5 + Math.random()*0.5, 1 + Math.random()*2);
                scene.add(fireLog);
            }

            // Evaporator Pan (Stainless)
            const panGeo = new THREE.BoxGeometry(4.4, 0.5, 6.4);
            const panMat = new THREE.MeshStandardMaterial({ color: 0xf1f5f9, metalness: 0.9, roughness: 0.1 });
            const pan = new THREE.Mesh(panGeo, panMat);
            pan.position.set(4, 3.25, 2);
            pan.castShadow = true;
            scene.add(pan);

            // Liquid inside pan (Syrup)
            const liquidGeo = new THREE.BoxGeometry(4.1, 0.4, 6.1);
            const liquidMat = new THREE.MeshStandardMaterial({ color: 0x92400e, transparent: true, opacity: 0.85, roughness: 0.1 }); // Amber
            const liquid = new THREE.Mesh(liquidGeo, liquidMat);
            liquid.position.set(4, 3.35, 2);
            scene.add(liquid);

            // Chemin√©e (Exhaust Stack)
            const chimneyGeo = new THREE.CylinderGeometry(0.4, 0.4, 6, 16);
            const chimneyMat = new THREE.MeshStandardMaterial({ color: 0x333333, metalness: 0.7, roughness: 0.6 });
            const chimney = new THREE.Mesh(chimneyGeo, chimneyMat);
            chimney.position.set(4, 6, -0.5);
            chimney.castShadow = true;
            scene.add(chimney);

            // Pr√©-chauffeur (Copper Coil)
            class SpiralCurve extends THREE.Curve {
                constructor(radius, height, turns) { super(); this.radius = radius; this.height = height; this.turns = turns; }
                getPoint(t, optionalTarget = new THREE.Vector3()) {
                    const angle = t * Math.PI * 2 * this.turns;
                    return optionalTarget.set(Math.cos(angle) * this.radius, t * this.height, Math.sin(angle) * this.radius);
                }
            }
            const spiralPath = new SpiralCurve(0.5, 3.5, 8); 
            const coilGeo = new THREE.TubeGeometry(spiralPath, 100, 0.05, 8, false);
            const copperMat = new THREE.MeshStandardMaterial({ color: 0xb87333, metalness: 0.9, roughness: 0.2 });
            const coil = new THREE.Mesh(coilGeo, copperMat);
            coil.position.set(4, 4, -0.5);
            scene.add(coil);

            // Cabane DIY (2x4 & T√¥le)
            const woodPostMat = new THREE.MeshStandardMaterial({ color: 0x8b5a2b, roughness: 1.0 }); 
            const tinRoofMat = new THREE.MeshStandardMaterial({ color: 0x64748b, metalness: 0.6, roughness: 0.4 }); 
            const postGeo = new THREE.BoxGeometry(0.3, 8.5, 0.3);
            const positions = [ [1.2, 4.25, -1.8], [6.8, 4.25, -1.8], [1.2, 4.25, 5.8], [6.8, 4.25, 5.8] ];
            positions.forEach(pos => {
                const post = new THREE.Mesh(postGeo, woodPostMat);
                post.position.set(pos[0], pos[1], pos[2]);
                post.castShadow = true;
                scene.add(post);
            });
            const roofGeo = new THREE.BoxGeometry(6.6, 0.1, 8.6);
            const roof = new THREE.Mesh(roofGeo, tinRoofMat);
            roof.position.set(4, 8.5, 2);
            roof.rotation.x = -Math.PI / 16; 
            roof.castShadow = true;
            scene.add(roof);

            // Fire glow inside arch
            const fireLight = new THREE.PointLight(0xf97316, 2.5, 12);
            fireLight.position.set(4, 1, 2);
            scene.add(fireLight);

            // Wood Pile
            const logGeo = new THREE.CylinderGeometry(0.3, 0.3, 2.5, 8);
            for(let i=0; i<3; i++) {
                for(let j=0; j<3-i; j++) {
                    const log = new THREE.Mesh(logGeo, woodPostMat);
                    log.rotation.z = Math.PI / 2;
                    log.position.set(4, 0.3 + (i * 0.5), -2.5 + (j * 0.6) + (i * 0.3));
                    log.castShadow = true;
                    log.receiveShadow = true;
                    scene.add(log);
                }
            }

            // --- NOUVEAUT√â : Syst√®me de Boucane (Smoke) ---
            const smokeParticles = [];
            const smokeGeo = new THREE.SphereGeometry(0.4, 8, 8);
            for(let i=0; i<12; i++) {
                // Cr√©er un mat√©riau unique par particule pour g√©rer l'opacit√© individuelle
                const puffMat = new THREE.MeshStandardMaterial({ color: 0xe2e8f0, transparent: true, opacity: 0.5, roughness: 1.0 });
                const puff = new THREE.Mesh(smokeGeo, puffMat);
                puff.position.set(4 + (Math.random()-0.5)*0.2, 9 + Math.random()*5, -0.5 + (Math.random()-0.5)*0.2);
                puff.scale.setScalar(1 + Math.random());
                scene.add(puff);
                smokeParticles.push({
                    mesh: puff,
                    speed: 0.03 + Math.random() * 0.04,
                    wobble: Math.random() * Math.PI * 2
                });
            }

            // --- NOUVEAUT√â : Syst√®me de Neige (Snow) ---
            const snowGeo = new THREE.BufferGeometry();
            const snowCount = 600;
            const snowPos = new Float32Array(snowCount * 3);
            for(let i=0; i<snowCount*3; i+=3) {
                snowPos[i] = (Math.random() - 0.5) * 40;     // x
                snowPos[i+1] = Math.random() * 25;           // y
                snowPos[i+2] = (Math.random() - 0.5) * 40;   // z
            }
            snowGeo.setAttribute('position', new THREE.BufferAttribute(snowPos, 3));
            const snowMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.15, transparent: true, opacity: 0.8 });
            const snowSystem = new THREE.Points(snowGeo, snowMaterial);
            scene.add(snowSystem);


            // Handle Resize
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });

            // Animation Loop
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                
                // Flicker the fire light slightly
                fireLight.intensity = 2.0 + Math.random() * 0.8;

                // Animer la boucane
                smokeParticles.forEach(p => {
                    p.mesh.position.y += p.speed;
                    p.mesh.position.x += Math.sin(p.wobble) * 0.015;
                    p.mesh.position.z += Math.cos(p.wobble) * 0.015;
                    p.wobble += 0.02;
                    p.mesh.scale.setScalar(p.mesh.scale.x + 0.01);
                    
                    // Fade out bas√© sur la hauteur
                    p.mesh.material.opacity = Math.max(0, 0.6 - ((p.mesh.position.y - 9) / 6)); 
                    
                    // Reset
                    if (p.mesh.position.y > 15) {
                        p.mesh.position.set(4 + (Math.random()-0.5)*0.3, 9, -0.5 + (Math.random()-0.5)*0.3);
                        p.mesh.scale.setScalar(1);
                        p.mesh.material.opacity = 0.6;
                    }
                });

                // Animer la neige
                const positions = snowSystem.geometry.attributes.position.array;
                for(let i=1; i<snowCount*3; i+=3) {
                    positions[i] -= 0.04; // vitesse de chute
                    // D√©rive avec le vent (x)
                    positions[i-1] -= 0.01; 
                    if(positions[i] < 0) {
                        positions[i] = 25; // reset hauteur
                        positions[i-1] = (Math.random() - 0.5) * 40; // reset position X
                    }
                }
                snowSystem.geometry.attributes.position.needsUpdate = true;

                renderer.render(scene, camera);
            }
            animate();
        }

        // Initialize 3D when window loads
        window.onload = function() {
            init3D();
        };

    </script>
</body>
</html>
