<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projet Minutieux - Visionneuse README</title>
    <!-- Tailwind CSS pour un design robuste et rapide -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked.js pour parser le Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Three.js pour la visualisation 3D -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        /* Styles de base pour le contenu Markdown rendu */
        .markdown-body h1 { font-size: 2em; font-weight: bold; margin-bottom: 0.5em; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.25em; }
        .markdown-body h2 { font-size: 1.5em; font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; }
        .markdown-body p { margin-bottom: 1em; line-height: 1.6; }
        .markdown-body a { color: #2563eb; text-decoration: underline; }
        .markdown-body ul { list-style-type: disc; padding-left: 2em; margin-bottom: 1em; }
        .markdown-body code { background-color: #f3f4f6; padding: 0.2em 0.4em; border-radius: 0.25em; font-family: monospace; }
        .markdown-body pre { background-color: #1f2937; color: #f3f4f6; padding: 1em; border-radius: 0.5em; overflow-x: auto; margin-bottom: 1em; }
        
        #canvas-container canvas { border-radius: 0.5rem; width: 100% !important; height: auto !important; aspect-ratio: 1 / 1; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans min-h-screen">

    <!-- En-t√™te -->
    <header class="bg-slate-800 text-white p-4 shadow-md">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold tracking-tight">üõ†Ô∏è Monsieur Minutieux</h1>
            <span class="text-sm bg-slate-700 px-3 py-1 rounded-full border border-slate-600">DIY & Design Robuste</span>
        </div>
    </header>

    <!-- Contenu Principal -->
    <main class="max-w-7xl mx-auto p-4 md:p-8 flex flex-col lg:flex-row gap-8">
        
        <!-- Colonne Gauche : Le README rendu -->
        <section class="flex-1 bg-white p-6 md:p-8 rounded-xl shadow-lg border-t-4 border-blue-600">
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <h2 class="text-xl font-bold text-gray-700">Documentation du Projet</h2>
                <a href="https://tmcdo.github.io/README.md" target="_blank" class="text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                    Source brute
                </a>
            </div>
            
            <div id="readme-content" class="markdown-body">
                <div class="flex items-center justify-center p-12 text-gray-500">
                    <svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Chargement du README depuis le d√©p√¥t...
                </div>
            </div>
        </section>

        <!-- Colonne Droite : Outils Minutieux (3D & DB) -->
        <aside class="w-full lg:w-96 flex flex-col gap-8">
            
            <!-- Widget 3D -->
            <div class="bg-white p-4 rounded-xl shadow-lg border-t-4 border-slate-800">
                <h3 class="text-lg font-bold text-gray-800 mb-2">Visualisation 3D (Composant)</h3>
                <p class="text-xs text-gray-500 mb-4">Aper√ßu interactif d'un boulon d'assemblage robuste. (Glisse la souris pour tourner)</p>
                <div id="canvas-container" class="bg-gray-50 rounded-lg overflow-hidden cursor-move border border-gray-200"></div>
            </div>

            <!-- Base de donn√©es exportable -->
            <div class="bg-white p-4 rounded-xl shadow-lg border-t-4 border-green-600">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800">Base de Mat√©riaux</h3>
                    <button id="export-btn" class="bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-3 rounded shadow transition-colors">
                        ‚Üì Exporter CSV
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th class="px-3 py-2">Objet</th>
                                <th class="px-3 py-2">Mat√©riau</th>
                                <th class="px-3 py-2">Co√ªt</th>
                            </tr>
                        </thead>
                        <tbody id="db-table-body">
                            <!-- Rempli par JS -->
                        </tbody>
                    </table>
                </div>
            </div>

        </aside>
    </main>

    <footer class="bg-slate-800 text-slate-400 text-center p-6 mt-8">
        <p class="text-sm">¬© 2026 Monsieur Minutieux - Design robuste, fabrication "low-cost" et sur-mesure.</p>
    </footer>

    <!-- Scripts de l'application -->
    <script>
        // --- 1. CHARGEMENT DU README.MD ---
        const urlToFetch = 'https://tmcdo.github.io/README.md';
        const readmeContainer = document.getElementById('readme-content');

        fetch(urlToFetch)
            .then(response => {
                if (!response.ok) throw new Error(`Erreur r√©seau: ${response.status}`);
                return response.text();
            })
            .then(markdownText => {
                // Parse le markdown en HTML avec marked.js
                // On v√©rifie si on n'a pas re√ßu une page HTML par erreur (fr√©quent avec Github Pages si le fichier n'existe pas)
                if(markdownText.trim().toLowerCase().startsWith('<!doctype html>')) {
                     readmeContainer.innerHTML = `<div class="p-4 bg-yellow-100 text-yellow-800 border-l-4 border-yellow-500">Oups! L'URL a retourn√© une page web au lieu d'un fichier Markdown brut. Assure-toi que le fichier existe bien √† cette adresse.</div>`;
                } else {
                    readmeContainer.innerHTML = marked.parse(markdownText);
                }
            })
            .catch(error => {
                console.error('Erreur lors du fetch:', error);
                readmeContainer.innerHTML = `<div class="p-4 bg-red-100 text-red-800 border-l-4 border-red-500 font-bold">Ayoye! Impossible de charger le fichier. V√©rifie que le lien est bon ou qu'il n'y a pas de restriction CORS. Erreur: ${error.message}</div>`;
            });

        // --- 2. BASE DE DONN√âES EXPORTABLE (DIY & Mat√©riaux) ---
        const materialsDB = [
            { id: 'M01', objet: 'Corni√®re 1.5"', materiau: 'Acier Galvanis√©', cout: '$', usage: 'Ch√¢ssis' },
            { id: 'M02', objet: 'Boulon Hex 3/8', materiau: 'Acier Grade 5', cout: '$', usage: 'Assemblage' },
            { id: 'M03', objet: 'Contreplaqu√© 3/4', materiau: 'Bois (√ârable)', cout: '$$', usage: 'Surfaces' },
            { id: 'M04', objet: 'Tube Carr√© 1"', materiau: 'Aluminium 6061', cout: '$$', usage: 'Structure l√©g√®re' },
            { id: 'M05', objet: '√âcrou Frein (Nylon)', materiau: 'Acier Zingu√©', cout: '$', usage: 'Anti-vibration' }
        ];

        // Remplir la table
        const tbody = document.getElementById('db-table-body');
        materialsDB.forEach(item => {
            const tr = document.createElement('tr');
            tr.className = "bg-white border-b";
            tr.innerHTML = `
                <td class="px-3 py-2 font-medium text-gray-900">${item.objet}</td>
                <td class="px-3 py-2">${item.materiau}</td>
                <td class="px-3 py-2 font-bold">${item.cout}</td>
            `;
            tbody.appendChild(tr);
        });

        // Fonction d'exportation CSV
        document.getElementById('export-btn').addEventListener('click', () => {
            let csvContent = "data:text/csv;charset=utf-8,ID,Objet,Mat√©riau,Co√ªt,Usage\n";
            materialsDB.forEach(row => {
                csvContent += `${row.id},"${row.objet}","${row.materiau}",${row.cout},"${row.usage}"\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "mrminutieux_materiaux.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // --- 3. VISUALISATION 3D (THREE.JS) ---
        window.onload = function () {
            const container = document.getElementById('canvas-container');
            const width = container.clientWidth;
            const height = width; // Carr√©
            
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf9fafb); // gris tr√®s p√¢le pour s'agencer au design

            const camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 1000);
            camera.position.z = 5;
            camera.position.y = 2;
            camera.lookAt(0, 0, 0);

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(width, height);
            container.appendChild(renderer.domElement);

            // Cr√©ation d'un boulon "low-cost" stylis√©
            const boltGroup = new THREE.Group();

            // T√™te hexagonale
            const headGeometry = new THREE.CylinderGeometry(0.8, 0.8, 0.5, 6);
            const metalMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x9ca3af, // Gris m√©tallique
                roughness: 0.4,
                metalness: 0.8
            });
            const head = new THREE.Mesh(headGeometry, metalMaterial);
            head.position.y = 1;
            boltGroup.add(head);

            // Tige du boulon
            const shaftGeometry = new THREE.CylinderGeometry(0.4, 0.4, 2, 16);
            const shaft = new THREE.Mesh(shaftGeometry, metalMaterial);
            shaft.position.y = -0.25;
            boltGroup.add(shaft);

            scene.add(boltGroup);

            // Lumi√®res pour un effet m√©tallique
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 2);
            scene.add(directionalLight);

            const pointLight = new THREE.PointLight(0xbfdbfe, 1, 10); // Lueur bleut√©e
            pointLight.position.set(-2, 0, 2);
            scene.add(pointLight);

            // Interaction souris pour tourner le boulon
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            container.addEventListener('mousedown', () => isDragging = true);
            container.addEventListener('mouseup', () => isDragging = false);
            container.addEventListener('mouseleave', () => isDragging = false);
            
            // Support tactile de base
            container.addEventListener('touchstart', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            }, {passive: true});
            container.addEventListener('touchend', () => isDragging = false);

            const handleMove = (clientX, clientY) => {
                if (isDragging) {
                    const deltaMove = {
                        x: clientX - previousMousePosition.x,
                        y: clientY - previousMousePosition.y
                    };
                    boltGroup.rotation.y += deltaMove.x * 0.01;
                    boltGroup.rotation.x += deltaMove.y * 0.01;
                }
                previousMousePosition = { x: clientX, y: clientY };
            };

            container.addEventListener('mousemove', (e) => handleMove(e.clientX, e.clientY));
            container.addEventListener('touchmove', (e) => {
                if(isDragging) handleMove(e.touches[0].clientX, e.touches[0].clientY);
            }, {passive: true});

            // Boucle d'animation
            function animate() {
                requestAnimationFrame(animate);
                // Petite rotation automatique lente si on ne touche √† rien
                if(!isDragging){
                    boltGroup.rotation.y += 0.005;
                }
                renderer.render(scene, camera);
            }

            // G√©rer le redimensionnement de la fen√™tre
            window.addEventListener('resize', () => {
                const newWidth = container.clientWidth;
                renderer.setSize(newWidth, newWidth);
                camera.aspect = 1;
                camera.updateProjectionMatrix();
            });

            animate();
        };
    </script>
</body>
</html>
