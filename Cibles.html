<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cibles de Tir Tactiques</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto Condensed', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #f3f4f6; /* text-gray-200 */
        }
        .target-container {
            background-color: white;
            border: 1px solid #4b5563; /* border-gray-600 */
            page-break-inside: avoid;
        }
        .target-svg {
            width: 100%;
            height: auto;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #print-section, #print-section * {
                visibility: visible;
            }
            #print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
            }
            .no-print {
                display: none;
            }
        }
        #renderer-container {
            width: 100%;
            height: 400px;
            background-color: #1f2937; /* bg-gray-800 */
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app-container">
        <header class="text-center mb-8 no-print">
            <h1 class="text-4xl font-bold text-white">Générateur de Cibles Tactiques</h1>
            <p class="text-lg text-gray-400 mt-2">Choisissez, visualisez en 3D et imprimez vos cibles d'entraînement.</p>
        </header>

        <!-- Section de visualisation 3D -->
        <div class="mb-8 p-4 bg-gray-800 rounded-lg shadow-lg no-print">
            <h2 class="text-2xl font-bold text-white mb-4 text-center">Visualisation 3D</h2>
            <div id="renderer-container" class="rounded-md overflow-hidden mx-auto"></div>
            <div class="mt-4 text-center">
                <label for="target-select" class="mr-2 text-gray-300">Changer la cible en 3D:</label>
                <select id="target-select" class="bg-gray-700 text-white rounded-md p-2">
                    <option value="alpha">Cible Alpha - Silhouette</option>
                    <option value="bravo">Cible Bravo - Otage</option>
                    <option value="charlie">Cible Charlie - Précision</option>
                    <option value="delta">Cible Delta - Points</option>
                </select>
            </div>
        </div>

        <!-- Section des cibles imprimables -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

            <!-- Cible Alpha -->
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h3 class="text-2xl font-bold text-white mb-2">Cible Alpha: Silhouette de Qualification</h3>
                <p class="text-gray-400 mb-4">Inspirée de la cible B-27, idéale pour pratiquer le tir au torse et à la tête. Les zones de score permettent de quantifier la précision.</p>
                <div id="target-alpha" class="target-container p-4">
                    <svg viewBox="0 0 200 280" class="target-svg" xmlns="http://www.w3.org/2000/svg">
                        <rect width="200" height="280" fill="white"/>
                        <g stroke="black" stroke-width="0.5">
                            <!-- Head -->
                            <ellipse cx="100" cy="40" rx="25" ry="30" fill="#E0E0E0"/>
                            <circle cx="100" cy="40" r="8" fill="none" stroke-dasharray="2,2"/>
                            <!-- Body -->
                            <path d="M50,80 Q50,150 100,270 Q150,150 150,80 Z" fill="#E0E0E0"/>
                            <!-- Scoring rings -->
                            <ellipse cx="100" cy="150" rx="45" ry="80" fill="none"/>
                            <ellipse cx="100" cy="150" rx="30" ry="55" fill="none"/>
                            <ellipse cx="100" cy="150" rx="15" ry="30" fill="none"/>
                            <text x="100" y="155" font-size="10" text-anchor="middle" fill="black" font-weight="bold">10</text>
                            <text x="100" y="120" font-size="8" text-anchor="middle" fill="black">9</text>
                            <text x="100" y="90" font-size="8" text-anchor="middle" fill="black">8</text>
                        </g>
                    </svg>
                </div>
                <button onclick="printTarget('target-alpha')" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded no-print">Imprimer Cible Alpha</button>
            </div>

            <!-- Cible Bravo -->
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h3 class="text-2xl font-bold text-white mb-2">Cible Bravo: Scénario d'Otage</h3>
                <p class="text-gray-400 mb-4">Exercice de discernement. Le but est de toucher la cible "menace" (en gris foncé) sans toucher la cible "otage" (en gris clair).</p>
                <div id="target-bravo" class="target-container p-4">
                    <svg viewBox="0 0 200 280" class="target-svg" xmlns="http://www.w3.org/2000/svg">
                        <rect width="200" height="280" fill="white"/>
                        <!-- Hostage (front) -->
                        <g fill="#E0E0E0" stroke="black" stroke-width="0.5">
                            <ellipse cx="120" cy="50" rx="25" ry="30"/>
                            <path d="M70,90 Q70,160 120,270 Q170,160 170,90 Z"/>
                            <text x="120" y="160" font-size="12" text-anchor="middle" fill="black" font-weight="bold">OTAGE</text>
                        </g>
                        <!-- Threat (back) -->
                        <g fill="#616161" stroke="black" stroke-width="0.5">
                            <ellipse cx="80" cy="45" rx="25" ry="30"/>
                            <path d="M30,85 Q30,155 80,265 Q130,155 130,85 Z"/>
                            <text x="80" y="155" font-size="12" text-anchor="middle" fill="white" font-weight="bold">MENACE</text>
                        </g>
                    </svg>
                </div>
                <button onclick="printTarget('target-bravo')" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded no-print">Imprimer Cible Bravo</button>
            </div>

            <!-- Cible Charlie -->
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h3 class="text-2xl font-bold text-white mb-2">Cible Charlie: Exercices de Précision</h3>
                <p class="text-gray-400 mb-4">Idéale pour les exercices de transition de cible et de tir rapide. Un partenaire peut appeler une forme et un numéro (ex: "Cercle 3!").</p>
                <div id="target-charlie" class="target-container p-4">
                    <svg viewBox="0 0 200 280" class="target-svg" xmlns="http://www.w3.org/2000/svg">
                        <rect width="200" height="280" fill="white"/>
                        <g stroke="black" stroke-width="0.5" fill="none" text-anchor="middle">
                            <!-- Row 1 -->
                            <circle cx="50" cy="50" r="20"/><text x="50" y="54" font-size="10">1</text>
                            <rect x="130" y="30" width="40" height="40"/><text x="150" y="54" font-size="10">2</text>
                            <!-- Row 2 -->
                            <polygon points="50,150 30,110 70,110"/><text x="50" y="128" font-size="10">3</text>
                            <circle cx="150" cy="130" r="20"/><text x="150" y="134" font-size="10">4</text>
                            <!-- Row 3 -->
                            <rect x="30" y="180" width="40" height="40"/><text x="50" y="204" font-size="10">5</text>
                            <polygon points="150,220 130,180 170,180"/><text x="150" y="198" font-size="10">6</text>
                             <!-- Row 4 -->
                            <circle cx="100" cy="250" r="15"/><text x="100" y="254" font-size="10">7</text>
                        </g>
                    </svg>
                </div>
                <button onclick="printTarget('target-charlie')" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded no-print">Imprimer Cible Charlie</button>
            </div>

            <!-- Cible Delta -->
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h3 class="text-2xl font-bold text-white mb-2">Cible Delta: "Dot Torture"</h3>
                <p class="text-gray-400 mb-4">Le test ultime de la maîtrise des fondamentaux du tir. Le but est de placer un tir dans chaque petit cercle, en suivant un ordre précis si désiré.</p>
                <div id="target-delta" class="target-container p-4">
                    <svg viewBox="0 0 200 280" class="target-svg" xmlns="http://www.w3.org/2000/svg">
                        <rect width="200" height="280" fill="white"/>
                        <g stroke="black" stroke-width="0.2" fill="black" text-anchor="middle">
                            <circle cx="30" cy="30" r="5"/><text x="30" y="22" font-size="6">1</text>
                            <circle cx="100" cy="30" r="5"/><text x="100" y="22" font-size="6">2</text>
                            <circle cx="170" cy="30" r="5"/><text x="170" y="22" font-size="6">3</text>
                            <circle cx="30" cy="100" r="5"/><text x="30" y="92" font-size="6">4</text>
                            <circle cx="100" cy="100" r="5"/><text x="100" y="92" font-size="6">5</text>
                            <circle cx="170" cy="100" r="5"/><text x="170" y="92" font-size="6">6</text>
                            <circle cx="30" cy="170" r="5"/><text x="30" y="162" font-size="6">7</text>
                            <circle cx="100" cy="170" r="5"/><text x="100" y="162" font-size="6">8</text>
                            <circle cx="170" cy="170" r="5"/><text x="170" y="162" font-size="6">9</text>
                            <circle cx="100" cy="240" r="10"/><text x="100" y="232" font-size="6">10</text>
                        </g>
                    </svg>
                </div>
                <button onclick="printTarget('target-delta')" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded no-print">Imprimer Cible Delta</button>
            </div>
        </div>

        <!-- Section Consignes -->
        <div class="mt-12 bg-gray-800 p-6 rounded-lg shadow-lg no-print">
            <h2 class="text-2xl font-bold text-white mb-4">Consignes d'Utilisation et de Sécurité</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>Matériel:</strong> Pour une solution robuste et à moindre coût, imprimez ces cibles sur du papier cartonné (type 160g/m² ou plus).</li>
                <li><strong>Support:</strong> Fixez la cible sur un support adéquat. Une grande boîte en carton remplie de vieux tissus, de journaux ou de caoutchouc constitue un excellent réceptacle à plombs (DIY et efficace).</li>
                <li><strong>Sécurité:</strong> Assurez-vous toujours que la zone derrière votre cible est sécuritaire et dépourvue d'obstacles, de personnes ou d'animaux.</li>
                <li><strong>Protection:</strong> Portez toujours des lunettes de protection. Les ricochets sont rares avec les plombs mais le risque existe.</li>
                <li><strong>Lieu:</strong> Pratiquez le tir dans un endroit où cela est permis et sécuritaire.</li>
            </ul>
        </div>
    </div>

    <!-- This div is used for printing -->
    <div id="print-section" class="hidden"></div>

    <script>
        // --- Print Function ---
        function printTarget(targetId) {
            const printContents = document.getElementById(targetId).innerHTML;
            const printSection = document.getElementById('print-section');
            printSection.innerHTML = printContents;
            window.print();
            printSection.innerHTML = ''; // Clean up after printing
        }

        // --- Three.js Scene ---
        let scene, camera, renderer, controls, targetMesh;
        const textures = {};

        function init3D() {
            const container = document.getElementById('renderer-container');

            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1f2937);

            // Camera
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 1.6, 3);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            // Controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 1, 0);
            controls.update();

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 7.5);
            scene.add(directionalLight);

            // Ground
            const groundGeo = new THREE.PlaneGeometry(20, 20);
            const groundMat = new THREE.MeshStandardMaterial({ color: 0x4a5568 });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.rotation.x = -Math.PI / 2;
            scene.add(ground);

            // Target Stand
            const standMaterial = new THREE.MeshStandardMaterial({ color: 0x8d6e63 });
            const postGeo = new THREE.CylinderGeometry(0.05, 0.05, 1.8, 8);
            const mainPost = new THREE.Mesh(postGeo, standMaterial);
            mainPost.position.y = 0.9;
            scene.add(mainPost);
            
            const baseGeo = new THREE.CylinderGeometry(0.3, 0.3, 0.05, 16);
            const base = new THREE.Mesh(baseGeo, standMaterial);
            base.position.y = 0.025;
            scene.add(base);

            // Preload textures
            const loader = new THREE.TextureLoader();
            const targetIds = ['alpha', 'bravo', 'charlie', 'delta'];
            targetIds.forEach(id => {
                const svgElement = document.getElementById(`target-${id}`).querySelector('svg');
                const svgString = new XMLSerializer().serializeToString(svgElement);
                const svgBlob = new Blob([svgString], {type: 'image/svg+xml;charset=utf-8'});
                const url = URL.createObjectURL(svgBlob);
                textures[id] = loader.load(url, () => {
                    // Revoke object URL after texture is loaded to free memory
                    URL.revokeObjectURL(url);
                });
            });

            // Target Plane
            const targetGeo = new THREE.PlaneGeometry(0.8, 0.8 * (280/200)); // Aspect ratio
            const targetMat = new THREE.MeshStandardMaterial({ map: textures['alpha'], side: THREE.DoubleSide });
            targetMesh = new THREE.Mesh(targetGeo, targetMat);
            targetMesh.position.set(0, 1.3, 0.05); // Slightly in front of the post
            scene.add(targetMesh);

            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);

            animate();
        }

        function onWindowResize() {
            const container = document.getElementById('renderer-container');
            if (!container) return;
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // --- Event Listeners ---
        document.getElementById('target-select').addEventListener('change', (event) => {
            const selectedId = event.target.value;
            if (targetMesh && textures[selectedId]) {
                targetMesh.material.map = textures[selectedId];
                targetMesh.material.needsUpdate = true;
            }
        });
        
        // Initialize 3D scene on load
        window.onload = init3D;

    </script>
</body>
</html>
